<template>
    <div class="doc-article">

<!--
    TODO: trouver un moyen plus indépendant et plus automatisé de générer ce fichier.
    Méthode actuelle:
     - aller sur : https://syntaxhighlighter.app/fr/python
     - choisir "type de thème" = "All"
     - choisir "Nom du thème" = "Dark Plus"
     - copier-coller le code de la librairie
     - cliquer sur "télécharger le fichier"
     - copier-coller le code généré dans le document. (à partir de la balise <pre>)
     - ajouter le code CSS "padding:0.5em;" dans la balise <pre>
-->

<h1 style="text-align: center;padding: 0.9em;">Code source de la librairie Squarity</h1>

<pre class="dark-plus" style="background-color:#1E1E1E;color:#D4D4D4;padding:0.5em;" tabindex="0"><code><div class="line"><span style="color:#C586C0">import</span><span style="color:#D4D4D4"> js</span></div><div class="line"><span style="color:#C586C0">import</span><span style="color:#D4D4D4"> sys</span></div><div class="line">
</div><div class="line">
</div><div class="line"><span style="color:#6A9955"># Technique pour rediriger les prints. Emprunté à Brython, mais ça marche aussi avec pyodide.</span></div><div class="line"><span style="color:#6A9955"># https://stackoverflow.com/questions/61348313/how-can-i-redirect-all-brython-output-to-a-textarea-element</span></div><div class="line"><span style="color:#569CD6">class</span><span style="color:#4EC9B0"> MyOutput</span><span style="color:#D4D4D4">:</span></div><div class="line"><span style="color:#569CD6">    def</span><span style="color:#DCDCAA"> __init__</span><span style="color:#D4D4D4">(</span><span style="color:#9CDCFE">self</span><span style="color:#D4D4D4">):</span></div><div class="line"><span style="color:#6A9955">        # https://pyodide.readthedocs.io/en/latest/using_pyodide_from_javascript.html</span></div><div class="line"><span style="color:#569CD6">        self</span><span style="color:#D4D4D4">.python_console = js.document.getElementById(</span><span style="color:#CE9178">"pythonConsole"</span><span style="color:#D4D4D4">)</span></div><div class="line">
</div><div class="line"><span style="color:#569CD6">    def</span><span style="color:#DCDCAA"> write</span><span style="color:#D4D4D4">(</span><span style="color:#9CDCFE">self</span><span style="color:#D4D4D4">, </span><span style="color:#9CDCFE">text</span><span style="color:#D4D4D4">):</span></div><div class="line"><span style="color:#569CD6">        self</span><span style="color:#D4D4D4">.python_console.textContent += text</span></div><div class="line"><span style="color:#569CD6">        self</span><span style="color:#D4D4D4">.python_console.scrollTop = </span><span style="color:#569CD6">self</span><span style="color:#D4D4D4">.python_console.scrollHeight</span></div><div class="line">
</div><div class="line"><span style="color:#D4D4D4">sys.stdout = MyOutput()</span></div><div class="line">
</div><div class="line">
</div><div class="line"><span style="color:#569CD6">class</span><span style="color:#4EC9B0"> Direction</span><span style="color:#D4D4D4">():</span></div><div class="line"><span style="color:#569CD6">    def</span><span style="color:#DCDCAA"> __init__</span><span style="color:#D4D4D4">(</span><span style="color:#9CDCFE">self</span><span style="color:#D4D4D4">, </span><span style="color:#9CDCFE">int_dir</span><span style="color:#D4D4D4">, </span><span style="color:#9CDCFE">str_dir</span><span style="color:#D4D4D4">, </span><span style="color:#9CDCFE">vector</span><span style="color:#D4D4D4">):</span></div><div class="line"><span style="color:#569CD6">        self</span><span style="color:#D4D4D4">.int_dir = int_dir</span></div><div class="line"><span style="color:#569CD6">        self</span><span style="color:#D4D4D4">.str_dir = str_dir</span></div><div class="line"><span style="color:#569CD6">        self</span><span style="color:#D4D4D4">.vector = vector</span></div><div class="line"><span style="color:#569CD6">        self</span><span style="color:#D4D4D4">.turned_cw = [</span><span style="color:#569CD6">None</span><span style="color:#D4D4D4">] * </span><span style="color:#B5CEA8">8</span></div><div class="line"><span style="color:#569CD6">        self</span><span style="color:#D4D4D4">.turned_ccw = [</span><span style="color:#569CD6">None</span><span style="color:#D4D4D4">] * </span><span style="color:#B5CEA8">8</span></div><div class="line">
</div><div class="line"><span style="color:#569CD6">    def</span><span style="color:#DCDCAA"> set_turned</span><span style="color:#D4D4D4">(</span><span style="color:#9CDCFE">self</span><span style="color:#D4D4D4">, </span><span style="color:#9CDCFE">turned_cw</span><span style="color:#D4D4D4">):</span></div><div class="line"><span style="color:#6A9955">        # Cette fonction est censée être appelée uniquement par la classe Directions.</span></div><div class="line"><span style="color:#569CD6">        self</span><span style="color:#D4D4D4">.turned_cw = turned_cw</span></div><div class="line"><span style="color:#569CD6">        self</span><span style="color:#D4D4D4">.turned_ccw = [</span><span style="color:#569CD6">self</span><span style="color:#D4D4D4">.turned_cw[</span><span style="color:#B5CEA8">0</span><span style="color:#D4D4D4">]] + </span><span style="color:#569CD6">self</span><span style="color:#D4D4D4">.turned_cw[:</span><span style="color:#B5CEA8">0</span><span style="color:#D4D4D4">:-</span><span style="color:#B5CEA8">1</span><span style="color:#D4D4D4">]</span></div><div class="line"><span style="color:#569CD6">        self</span><span style="color:#D4D4D4">.opposite = </span><span style="color:#569CD6">self</span><span style="color:#D4D4D4">.turned_cw[</span><span style="color:#B5CEA8">4</span><span style="color:#D4D4D4">]</span></div><div class="line">
</div><div class="line"><span style="color:#569CD6">    def</span><span style="color:#DCDCAA"> turn_cw</span><span style="color:#D4D4D4">(</span><span style="color:#9CDCFE">self</span><span style="color:#D4D4D4">, </span><span style="color:#9CDCFE">n</span><span style="color:#D4D4D4">=</span><span style="color:#B5CEA8">2</span><span style="color:#D4D4D4">):</span></div><div class="line"><span style="color:#C586C0">        return</span><span style="color:#569CD6"> self</span><span style="color:#D4D4D4">.turned_cw[n % </span><span style="color:#B5CEA8">8</span><span style="color:#D4D4D4">]</span></div><div class="line">
</div><div class="line"><span style="color:#569CD6">    def</span><span style="color:#DCDCAA"> turn_ccw</span><span style="color:#D4D4D4">(</span><span style="color:#9CDCFE">self</span><span style="color:#D4D4D4">, </span><span style="color:#9CDCFE">n</span><span style="color:#D4D4D4">=</span><span style="color:#B5CEA8">2</span><span style="color:#D4D4D4">):</span></div><div class="line"><span style="color:#C586C0">        return</span><span style="color:#569CD6"> self</span><span style="color:#D4D4D4">.turned_ccw[n % </span><span style="color:#B5CEA8">8</span><span style="color:#D4D4D4">]</span></div><div class="line">
</div><div class="line"><span style="color:#569CD6">    def</span><span style="color:#DCDCAA"> __eq__</span><span style="color:#D4D4D4">(</span><span style="color:#9CDCFE">self</span><span style="color:#D4D4D4">, </span><span style="color:#9CDCFE">other</span><span style="color:#D4D4D4">):</span></div><div class="line"><span style="color:#C586C0">        return</span><span style="color:#569CD6"> self</span><span style="color:#D4D4D4">.int_dir == other.int_dir</span></div><div class="line">
</div><div class="line"><span style="color:#569CD6">    def</span><span style="color:#DCDCAA"> __int__</span><span style="color:#D4D4D4">(</span><span style="color:#9CDCFE">self</span><span style="color:#D4D4D4">):</span></div><div class="line"><span style="color:#C586C0">        return</span><span style="color:#569CD6"> self</span><span style="color:#D4D4D4">.int_dir</span></div><div class="line">
</div><div class="line"><span style="color:#569CD6">    def</span><span style="color:#DCDCAA"> __repr__</span><span style="color:#D4D4D4">(</span><span style="color:#9CDCFE">self</span><span style="color:#D4D4D4">):</span></div><div class="line"><span style="color:#C586C0">        return</span><span style="color:#569CD6"> self</span><span style="color:#D4D4D4">.str_dir</span></div><div class="line">
</div><div class="line">
</div><div class="line"><span style="color:#569CD6">class</span><span style="color:#4EC9B0"> Directions</span><span style="color:#D4D4D4">():</span></div><div class="line"><span style="color:#569CD6">    def</span><span style="color:#DCDCAA"> __init__</span><span style="color:#D4D4D4">(</span><span style="color:#9CDCFE">self</span><span style="color:#D4D4D4">):</span></div><div class="line"><span style="color:#569CD6">        self</span><span style="color:#D4D4D4">.Up = Direction(</span><span style="color:#B5CEA8">0</span><span style="color:#D4D4D4">, </span><span style="color:#CE9178">"up"</span><span style="color:#D4D4D4">, (</span><span style="color:#B5CEA8">0</span><span style="color:#D4D4D4">, -</span><span style="color:#B5CEA8">1</span><span style="color:#D4D4D4">))</span></div><div class="line"><span style="color:#569CD6">        self</span><span style="color:#D4D4D4">.UpRight = Direction(</span><span style="color:#B5CEA8">1</span><span style="color:#D4D4D4">, </span><span style="color:#CE9178">"up_right"</span><span style="color:#D4D4D4">, (+</span><span style="color:#B5CEA8">1</span><span style="color:#D4D4D4">, -</span><span style="color:#B5CEA8">1</span><span style="color:#D4D4D4">))</span></div><div class="line"><span style="color:#569CD6">        self</span><span style="color:#D4D4D4">.Right = Direction(</span><span style="color:#B5CEA8">2</span><span style="color:#D4D4D4">, </span><span style="color:#CE9178">"right"</span><span style="color:#D4D4D4">, (+</span><span style="color:#B5CEA8">1</span><span style="color:#D4D4D4">, </span><span style="color:#B5CEA8">0</span><span style="color:#D4D4D4">))</span></div><div class="line"><span style="color:#569CD6">        self</span><span style="color:#D4D4D4">.DownRight = Direction(</span><span style="color:#B5CEA8">3</span><span style="color:#D4D4D4">, </span><span style="color:#CE9178">"down_right"</span><span style="color:#D4D4D4">, (+</span><span style="color:#B5CEA8">1</span><span style="color:#D4D4D4">, +</span><span style="color:#B5CEA8">1</span><span style="color:#D4D4D4">))</span></div><div class="line"><span style="color:#569CD6">        self</span><span style="color:#D4D4D4">.Down = Direction(</span><span style="color:#B5CEA8">4</span><span style="color:#D4D4D4">, </span><span style="color:#CE9178">"down"</span><span style="color:#D4D4D4">, (</span><span style="color:#B5CEA8">0</span><span style="color:#D4D4D4">, +</span><span style="color:#B5CEA8">1</span><span style="color:#D4D4D4">))</span></div><div class="line"><span style="color:#569CD6">        self</span><span style="color:#D4D4D4">.DownLeft = Direction(</span><span style="color:#B5CEA8">5</span><span style="color:#D4D4D4">, </span><span style="color:#CE9178">"down_left"</span><span style="color:#D4D4D4">, (-</span><span style="color:#B5CEA8">1</span><span style="color:#D4D4D4">, +</span><span style="color:#B5CEA8">1</span><span style="color:#D4D4D4">))</span></div><div class="line"><span style="color:#569CD6">        self</span><span style="color:#D4D4D4">.Left = Direction(</span><span style="color:#B5CEA8">6</span><span style="color:#D4D4D4">, </span><span style="color:#CE9178">"left"</span><span style="color:#D4D4D4">, (-</span><span style="color:#B5CEA8">1</span><span style="color:#D4D4D4">, </span><span style="color:#B5CEA8">0</span><span style="color:#D4D4D4">))</span></div><div class="line"><span style="color:#569CD6">        self</span><span style="color:#D4D4D4">.UpLeft = Direction(</span><span style="color:#B5CEA8">7</span><span style="color:#D4D4D4">, </span><span style="color:#CE9178">"up_left"</span><span style="color:#D4D4D4">, (-</span><span style="color:#B5CEA8">1</span><span style="color:#D4D4D4">, -</span><span style="color:#B5CEA8">1</span><span style="color:#D4D4D4">))</span></div><div class="line"><span style="color:#569CD6">        self</span><span style="color:#D4D4D4">.as_list = [</span></div><div class="line"><span style="color:#569CD6">            self</span><span style="color:#D4D4D4">.Up, </span><span style="color:#569CD6">self</span><span style="color:#D4D4D4">.UpRight, </span><span style="color:#569CD6">self</span><span style="color:#D4D4D4">.Right, </span><span style="color:#569CD6">self</span><span style="color:#D4D4D4">.DownRight,</span></div><div class="line"><span style="color:#569CD6">            self</span><span style="color:#D4D4D4">.Down, </span><span style="color:#569CD6">self</span><span style="color:#D4D4D4">.DownLeft, </span><span style="color:#569CD6">self</span><span style="color:#D4D4D4">.Left, </span><span style="color:#569CD6">self</span><span style="color:#D4D4D4">.UpLeft,</span></div><div class="line"><span style="color:#D4D4D4">        ]</span></div><div class="line"><span style="color:#D4D4D4">        turns = </span><span style="color:#4EC9B0">list</span><span style="color:#D4D4D4">(</span><span style="color:#569CD6">self</span><span style="color:#D4D4D4">.as_list)</span></div><div class="line"><span style="color:#C586C0">        for</span><span style="color:#D4D4D4"> direc </span><span style="color:#C586C0">in</span><span style="color:#569CD6"> self</span><span style="color:#D4D4D4">.as_list:</span></div><div class="line"><span style="color:#D4D4D4">            direc.set_turned(turns)</span></div><div class="line"><span style="color:#D4D4D4">            turns = turns[</span><span style="color:#B5CEA8">1</span><span style="color:#D4D4D4">:] + turns[:</span><span style="color:#B5CEA8">1</span><span style="color:#D4D4D4">]</span></div><div class="line">
</div><div class="line"><span style="color:#D4D4D4">dirs = Directions()</span></div><div class="line">
</div><div class="line">
</div><div class="line"><span style="color:#569CD6">class</span><span style="color:#4EC9B0"> Coord</span><span style="color:#D4D4D4">:</span></div><div class="line">
</div><div class="line"><span style="color:#569CD6">    def</span><span style="color:#DCDCAA"> __init__</span><span style="color:#D4D4D4">(</span><span style="color:#9CDCFE">self</span><span style="color:#D4D4D4">, </span><span style="color:#9CDCFE">x</span><span style="color:#D4D4D4">=</span><span style="color:#569CD6">None</span><span style="color:#D4D4D4">, </span><span style="color:#9CDCFE">y</span><span style="color:#D4D4D4">=</span><span style="color:#569CD6">None</span><span style="color:#D4D4D4">, </span><span style="color:#9CDCFE">coord</span><span style="color:#D4D4D4">=</span><span style="color:#569CD6">None</span><span style="color:#D4D4D4">):</span></div><div class="line"><span style="color:#C586C0">        if</span><span style="color:#D4D4D4"> coord </span><span style="color:#569CD6">is</span><span style="color:#569CD6"> not</span><span style="color:#569CD6"> None</span><span style="color:#D4D4D4">:</span></div><div class="line"><span style="color:#569CD6">            self</span><span style="color:#D4D4D4">.x = coord.x</span></div><div class="line"><span style="color:#569CD6">            self</span><span style="color:#D4D4D4">.y = coord.y</span></div><div class="line"><span style="color:#C586C0">        else</span><span style="color:#D4D4D4">:</span></div><div class="line"><span style="color:#569CD6">            self</span><span style="color:#D4D4D4">.x = x</span></div><div class="line"><span style="color:#569CD6">            self</span><span style="color:#D4D4D4">.y = y</span></div><div class="line"><span style="color:#C586C0">        if</span><span style="color:#569CD6"> self</span><span style="color:#D4D4D4">.x </span><span style="color:#569CD6">is</span><span style="color:#569CD6"> None</span><span style="color:#569CD6"> or</span><span style="color:#569CD6"> self</span><span style="color:#D4D4D4">.y </span><span style="color:#569CD6">is</span><span style="color:#569CD6"> None</span><span style="color:#D4D4D4">:</span></div><div class="line"><span style="color:#C586C0">            raise</span><span style="color:#4EC9B0"> ValueError</span><span style="color:#D4D4D4">(</span><span style="color:#CE9178">"Coord must be initialized with x and y or coord."</span><span style="color:#D4D4D4">)</span></div><div class="line">
</div><div class="line"><span style="color:#569CD6">    def</span><span style="color:#DCDCAA"> __eq__</span><span style="color:#D4D4D4">(</span><span style="color:#9CDCFE">self</span><span style="color:#D4D4D4">, </span><span style="color:#9CDCFE">other</span><span style="color:#D4D4D4">):</span></div><div class="line"><span style="color:#C586C0">        return</span><span style="color:#569CD6"> self</span><span style="color:#D4D4D4">.x == other.x </span><span style="color:#569CD6">and</span><span style="color:#569CD6"> self</span><span style="color:#D4D4D4">.y == other.y</span></div><div class="line">
</div><div class="line"><span style="color:#569CD6">    def</span><span style="color:#DCDCAA"> __hash__</span><span style="color:#D4D4D4">(</span><span style="color:#9CDCFE">self</span><span style="color:#D4D4D4">):</span></div><div class="line"><span style="color:#C586C0">        return</span><span style="color:#DCDCAA"> hash</span><span style="color:#D4D4D4">((</span><span style="color:#569CD6">self</span><span style="color:#D4D4D4">.x, </span><span style="color:#569CD6">self</span><span style="color:#D4D4D4">.y))</span></div><div class="line">
</div><div class="line"><span style="color:#569CD6">    def</span><span style="color:#DCDCAA"> __repr__</span><span style="color:#D4D4D4">(</span><span style="color:#9CDCFE">self</span><span style="color:#D4D4D4">):</span></div><div class="line"><span style="color:#C586C0">        return</span><span style="color:#569CD6"> f</span><span style="color:#CE9178">"&#x3C;Coord </span><span style="color:#569CD6">{self</span><span style="color:#D4D4D4">.x</span><span style="color:#569CD6">}</span><span style="color:#CE9178">, </span><span style="color:#569CD6">{self</span><span style="color:#D4D4D4">.y</span><span style="color:#569CD6">}</span><span style="color:#CE9178"> >"</span></div><div class="line">
</div><div class="line"><span style="color:#569CD6">    def</span><span style="color:#DCDCAA"> clone</span><span style="color:#D4D4D4">(</span><span style="color:#9CDCFE">self</span><span style="color:#D4D4D4">):</span></div><div class="line"><span style="color:#C586C0">        return</span><span style="color:#D4D4D4"> Coord(</span><span style="color:#9CDCFE">coord</span><span style="color:#D4D4D4">=</span><span style="color:#569CD6">self</span><span style="color:#D4D4D4">)</span></div><div class="line">
</div><div class="line"><span style="color:#569CD6">    def</span><span style="color:#DCDCAA"> move_dir</span><span style="color:#D4D4D4">(</span><span style="color:#9CDCFE">self</span><span style="color:#D4D4D4">, </span><span style="color:#9CDCFE">direction</span><span style="color:#D4D4D4">, </span><span style="color:#9CDCFE">dist</span><span style="color:#D4D4D4">=</span><span style="color:#B5CEA8">1</span><span style="color:#D4D4D4">):</span></div><div class="line"><span style="color:#D4D4D4">        mov_x, mov_y = direction.vector</span></div><div class="line"><span style="color:#569CD6">        self</span><span style="color:#D4D4D4">.x += mov_x * dist</span></div><div class="line"><span style="color:#569CD6">        self</span><span style="color:#D4D4D4">.y += mov_y * dist</span></div><div class="line"><span style="color:#6A9955">        # C'est étrange de renvoyer self, mais ça permet de chaîner les actions.</span></div><div class="line"><span style="color:#6A9955">        # Par exemple: my_coord.clone().move_dir(...)</span></div><div class="line"><span style="color:#C586C0">        return</span><span style="color:#569CD6"> self</span></div><div class="line">
</div><div class="line"><span style="color:#569CD6">    def</span><span style="color:#DCDCAA"> move_by_vect</span><span style="color:#D4D4D4">(</span><span style="color:#9CDCFE">self</span><span style="color:#D4D4D4">, </span><span style="color:#9CDCFE">vector</span><span style="color:#D4D4D4">=</span><span style="color:#569CD6">None</span><span style="color:#D4D4D4">, </span><span style="color:#9CDCFE">x</span><span style="color:#D4D4D4">=</span><span style="color:#569CD6">None</span><span style="color:#D4D4D4">, </span><span style="color:#9CDCFE">y</span><span style="color:#D4D4D4">=</span><span style="color:#569CD6">None</span><span style="color:#D4D4D4">):</span></div><div class="line"><span style="color:#C586C0">        if</span><span style="color:#D4D4D4"> vector </span><span style="color:#569CD6">is</span><span style="color:#569CD6"> not</span><span style="color:#569CD6"> None</span><span style="color:#D4D4D4">:</span></div><div class="line"><span style="color:#569CD6">            self</span><span style="color:#D4D4D4">.x += vector.x</span></div><div class="line"><span style="color:#569CD6">            self</span><span style="color:#D4D4D4">.y += vector.y</span></div><div class="line"><span style="color:#C586C0">        if</span><span style="color:#D4D4D4"> x </span><span style="color:#569CD6">is</span><span style="color:#569CD6"> not</span><span style="color:#569CD6"> None</span><span style="color:#D4D4D4">:</span></div><div class="line"><span style="color:#569CD6">            self</span><span style="color:#D4D4D4">.x += x</span></div><div class="line"><span style="color:#C586C0">        if</span><span style="color:#D4D4D4"> y </span><span style="color:#569CD6">is</span><span style="color:#569CD6"> not</span><span style="color:#569CD6"> None</span><span style="color:#D4D4D4">:</span></div><div class="line"><span style="color:#569CD6">            self</span><span style="color:#D4D4D4">.y += y</span></div><div class="line"><span style="color:#C586C0">        return</span><span style="color:#569CD6"> self</span></div><div class="line">
</div><div class="line">
</div><div class="line"><span style="color:#569CD6">class</span><span style="color:#4EC9B0"> Rect</span><span style="color:#D4D4D4">:</span></div><div class="line">
</div><div class="line"><span style="color:#569CD6">    def</span><span style="color:#DCDCAA"> __init__</span><span style="color:#D4D4D4">(</span><span style="color:#9CDCFE">self</span><span style="color:#D4D4D4">, </span><span style="color:#9CDCFE">x</span><span style="color:#D4D4D4">, </span><span style="color:#9CDCFE">y</span><span style="color:#D4D4D4">, </span><span style="color:#9CDCFE">w</span><span style="color:#D4D4D4">, </span><span style="color:#9CDCFE">h</span><span style="color:#D4D4D4">):</span></div><div class="line"><span style="color:#569CD6">        self</span><span style="color:#D4D4D4">.x = x</span></div><div class="line"><span style="color:#569CD6">        self</span><span style="color:#D4D4D4">.y = y</span></div><div class="line"><span style="color:#569CD6">        self</span><span style="color:#D4D4D4">.w = w</span></div><div class="line"><span style="color:#569CD6">        self</span><span style="color:#D4D4D4">.h = h</span></div><div class="line">
</div><div class="line"><span style="color:#569CD6">    def</span><span style="color:#DCDCAA"> in_bounds</span><span style="color:#D4D4D4">(</span><span style="color:#9CDCFE">self</span><span style="color:#D4D4D4">, </span><span style="color:#9CDCFE">coord</span><span style="color:#D4D4D4">):</span></div><div class="line"><span style="color:#C586C0">        if</span><span style="color:#569CD6"> not</span><span style="color:#D4D4D4"> (</span><span style="color:#569CD6">self</span><span style="color:#D4D4D4">.x &#x3C;= coord.x &#x3C; </span><span style="color:#569CD6">self</span><span style="color:#D4D4D4">.x+</span><span style="color:#569CD6">self</span><span style="color:#D4D4D4">.w):</span></div><div class="line"><span style="color:#C586C0">            return</span><span style="color:#569CD6"> False</span></div><div class="line"><span style="color:#C586C0">        if</span><span style="color:#569CD6"> not</span><span style="color:#D4D4D4"> (</span><span style="color:#569CD6">self</span><span style="color:#D4D4D4">.y &#x3C;= coord.y &#x3C; </span><span style="color:#569CD6">self</span><span style="color:#D4D4D4">.y+</span><span style="color:#569CD6">self</span><span style="color:#D4D4D4">.h):</span></div><div class="line"><span style="color:#C586C0">            return</span><span style="color:#569CD6"> False</span></div><div class="line"><span style="color:#C586C0">        return</span><span style="color:#569CD6"> True</span></div><div class="line">
</div><div class="line"><span style="color:#569CD6">    def</span><span style="color:#DCDCAA"> on_border</span><span style="color:#D4D4D4">(</span><span style="color:#9CDCFE">self</span><span style="color:#D4D4D4">, </span><span style="color:#9CDCFE">coord</span><span style="color:#D4D4D4">):</span></div><div class="line"><span style="color:#C586C0">        if</span><span style="color:#569CD6"> not</span><span style="color:#569CD6"> self</span><span style="color:#D4D4D4">.in_bounds(coord):</span></div><div class="line"><span style="color:#C586C0">            return</span><span style="color:#569CD6"> False</span></div><div class="line"><span style="color:#C586C0">        if</span><span style="color:#D4D4D4"> coord.x == </span><span style="color:#569CD6">self</span><span style="color:#D4D4D4">.x:</span><span style="color:#C586C0">return</span><span style="color:#569CD6"> True</span></div><div class="line"><span style="color:#C586C0">        if</span><span style="color:#D4D4D4"> coord.y == </span><span style="color:#569CD6">self</span><span style="color:#D4D4D4">.y:</span><span style="color:#C586C0">return</span><span style="color:#569CD6"> True</span></div><div class="line"><span style="color:#C586C0">        if</span><span style="color:#D4D4D4"> coord.x == </span><span style="color:#569CD6">self</span><span style="color:#D4D4D4">.x + </span><span style="color:#569CD6">self</span><span style="color:#D4D4D4">.w - </span><span style="color:#B5CEA8">1</span><span style="color:#D4D4D4">:</span><span style="color:#C586C0">return</span><span style="color:#569CD6"> True</span></div><div class="line"><span style="color:#C586C0">        if</span><span style="color:#D4D4D4"> coord.y == </span><span style="color:#569CD6">self</span><span style="color:#D4D4D4">.y + </span><span style="color:#569CD6">self</span><span style="color:#D4D4D4">.h - </span><span style="color:#B5CEA8">1</span><span style="color:#D4D4D4">:</span><span style="color:#C586C0">return</span><span style="color:#569CD6"> True</span></div><div class="line"><span style="color:#C586C0">        return</span><span style="color:#569CD6"> False</span></div><div class="line">
</div><div class="line"><span style="color:#569CD6">    def</span><span style="color:#DCDCAA"> __repr__</span><span style="color:#D4D4D4">(</span><span style="color:#9CDCFE">self</span><span style="color:#D4D4D4">):</span></div><div class="line"><span style="color:#C586C0">        return</span><span style="color:#569CD6"> f</span><span style="color:#CE9178">"&#x3C;Rect </span><span style="color:#569CD6">{self</span><span style="color:#D4D4D4">.x</span><span style="color:#569CD6">}</span><span style="color:#CE9178">, </span><span style="color:#569CD6">{self</span><span style="color:#D4D4D4">.y</span><span style="color:#569CD6">}</span><span style="color:#CE9178">, </span><span style="color:#569CD6">{self</span><span style="color:#D4D4D4">.w</span><span style="color:#569CD6">}</span><span style="color:#CE9178">, </span><span style="color:#569CD6">{self</span><span style="color:#D4D4D4">.h</span><span style="color:#569CD6">}</span><span style="color:#CE9178"> >"</span></div><div class="line">
</div><div class="line">
</div><div class="line"><span style="color:#569CD6">class</span><span style="color:#4EC9B0"> TransitionSteps</span><span style="color:#D4D4D4">():</span></div><div class="line"><span style="color:#CE9178">    """</span></div><div class="line"><span style="color:#CE9178">    La variable field_name peut être "coord" ou "sprite_name"</span></div><div class="line"><span style="color:#CE9178">    Ensuite, on indique une liste de tuples (delay, valeur).</span></div><div class="line"><span style="color:#CE9178">    Pour indiquer une callback, il faut mettre un objet squarity.Callback</span></div><div class="line"><span style="color:#CE9178">    """</span></div><div class="line"><span style="color:#569CD6">    def</span><span style="color:#DCDCAA"> __init__</span><span style="color:#D4D4D4">(</span><span style="color:#9CDCFE">self</span><span style="color:#D4D4D4">, </span><span style="color:#9CDCFE">field_name</span><span style="color:#D4D4D4">, </span><span style="color:#9CDCFE">steps</span><span style="color:#D4D4D4">):</span></div><div class="line"><span style="color:#569CD6">        self</span><span style="color:#D4D4D4">.field_name = field_name</span></div><div class="line"><span style="color:#569CD6">        self</span><span style="color:#D4D4D4">.steps = steps</span></div><div class="line">
</div><div class="line">
</div><div class="line"><span style="color:#569CD6">class</span><span style="color:#4EC9B0"> PlayerLockTransi</span><span style="color:#D4D4D4">():</span></div><div class="line"><span style="color:#D4D4D4">    NO_LOCK = </span><span style="color:#B5CEA8">0</span></div><div class="line"><span style="color:#D4D4D4">    INVISIBLE = </span><span style="color:#B5CEA8">1</span></div><div class="line"><span style="color:#D4D4D4">    LOCK = </span><span style="color:#B5CEA8">2</span></div><div class="line">
</div><div class="line">
</div><div class="line"><span style="color:#569CD6">class</span><span style="color:#4EC9B0"> GameObjectBase</span><span style="color:#D4D4D4">():</span></div><div class="line"><span style="color:#569CD6">    def</span><span style="color:#DCDCAA"> __init__</span><span style="color:#D4D4D4">(</span><span style="color:#9CDCFE">self</span><span style="color:#D4D4D4">):</span></div><div class="line"><span style="color:#569CD6">        self</span><span style="color:#D4D4D4">._go_id = </span><span style="color:#DCDCAA">id</span><span style="color:#D4D4D4">(</span><span style="color:#569CD6">self</span><span style="color:#D4D4D4">)</span></div><div class="line">
</div><div class="line">
</div><div class="line"><span style="color:#569CD6">class</span><span style="color:#4EC9B0"> GameObject</span><span style="color:#D4D4D4">(</span><span style="color:#4EC9B0">GameObjectBase</span><span style="color:#D4D4D4">):</span></div><div class="line">
</div><div class="line"><span style="color:#569CD6">    def</span><span style="color:#DCDCAA"> __init__</span><span style="color:#D4D4D4">(</span></div><div class="line"><span style="color:#9CDCFE">            self</span><span style="color:#D4D4D4">,</span></div><div class="line"><span style="color:#9CDCFE">            coord</span><span style="color:#D4D4D4">,</span></div><div class="line"><span style="color:#9CDCFE">            sprite_name</span><span style="color:#D4D4D4">,</span></div><div class="line"><span style="color:#9CDCFE">            layer_owner</span><span style="color:#D4D4D4">=</span><span style="color:#569CD6">None</span><span style="color:#D4D4D4">,</span></div><div class="line"><span style="color:#9CDCFE">            image_modifier</span><span style="color:#D4D4D4">=</span><span style="color:#569CD6">None</span><span style="color:#D4D4D4">,</span></div><div class="line"><span style="color:#9CDCFE">            back_caller</span><span style="color:#D4D4D4">=</span><span style="color:#569CD6">None</span><span style="color:#D4D4D4">,</span></div><div class="line"><span style="color:#D4D4D4">        ):</span></div><div class="line"><span style="color:#CE9178">        """</span></div><div class="line"><span style="color:#CE9178">        Les deux composants image_modifier et back_caller doivent être ajoutés dès le départ.</span></div><div class="line"><span style="color:#CE9178">        Si on les crée après le __init__, ce n'est pas pris en compte par le moteur du jeu.</span></div><div class="line"><span style="color:#CE9178">        C'est pour optimiser les vérifs et les traitements.</span></div><div class="line"><span style="color:#CE9178">        Si vous voulez un game object avec un image_modifier alors qu'il n'en n'a pas au départ,</span></div><div class="line"><span style="color:#CE9178">        il n'y a pas d'autres solutions que de détruire-recréer ce game object. C'est comme ça.</span></div><div class="line"><span style="color:#CE9178">        """</span></div><div class="line"><span style="color:#4EC9B0">        super</span><span style="color:#D4D4D4">().</span><span style="color:#DCDCAA">__init__</span><span style="color:#D4D4D4">()</span></div><div class="line"><span style="color:#569CD6">        self</span><span style="color:#D4D4D4">._coord = Coord(</span><span style="color:#9CDCFE">coord</span><span style="color:#D4D4D4">=coord)</span></div><div class="line"><span style="color:#569CD6">        self</span><span style="color:#D4D4D4">.sprite_name = sprite_name</span></div><div class="line"><span style="color:#569CD6">        self</span><span style="color:#D4D4D4">.layer_owner = layer_owner</span></div><div class="line"><span style="color:#569CD6">        self</span><span style="color:#D4D4D4">.image_modifier = image_modifier</span></div><div class="line"><span style="color:#569CD6">        self</span><span style="color:#D4D4D4">.back_caller = back_caller</span></div><div class="line"><span style="color:#569CD6">        self</span><span style="color:#D4D4D4">.plock_transi = PlayerLockTransi.NO_LOCK</span></div><div class="line">
</div><div class="line"><span style="color:#6A9955">        # FUTURE: pour plus tard.</span></div><div class="line"><span style="color:#6A9955">        # self.visible = True</span></div><div class="line"><span style="color:#6A9955">        # FUTURE: on gérera les autres transfo plus tard (rotation, opacity, ...).</span></div><div class="line"><span style="color:#6A9955">        # self.angle = 0.0</span></div><div class="line"><span style="color:#6A9955">        # self.opacity = 1.0</span></div><div class="line"><span style="color:#6A9955">        # Not sure if we will implement the color_factor.</span></div><div class="line"><span style="color:#6A9955">        # self.color_factor = (1.0, 1.0, 1.0)</span></div><div class="line">
</div><div class="line"><span style="color:#569CD6">        self</span><span style="color:#D4D4D4">._transitioner = </span><span style="color:#569CD6">None</span></div><div class="line"><span style="color:#569CD6">        self</span><span style="color:#D4D4D4">._transitions_to_record = []</span></div><div class="line"><span style="color:#569CD6">        self</span><span style="color:#D4D4D4">._must_clear_transitions = </span><span style="color:#569CD6">False</span></div><div class="line"><span style="color:#569CD6">        self</span><span style="color:#D4D4D4">._transition_delay = </span><span style="color:#569CD6">None</span></div><div class="line"><span style="color:#569CD6">        self</span><span style="color:#D4D4D4">._callback_end_transi = </span><span style="color:#569CD6">None</span></div><div class="line"><span style="color:#569CD6">        self</span><span style="color:#D4D4D4">._one_shot_transition_delay = </span><span style="color:#569CD6">None</span></div><div class="line"><span style="color:#569CD6">        self</span><span style="color:#D4D4D4">._one_shot_callback = </span><span style="color:#569CD6">None</span></div><div class="line">
</div><div class="line"><span style="color:#569CD6">    def</span><span style="color:#DCDCAA"> get_coord</span><span style="color:#D4D4D4">(</span><span style="color:#9CDCFE">self</span><span style="color:#D4D4D4">):</span></div><div class="line"><span style="color:#C586C0">        return</span><span style="color:#D4D4D4"> Coord(</span><span style="color:#9CDCFE">coord</span><span style="color:#D4D4D4">=</span><span style="color:#569CD6">self</span><span style="color:#D4D4D4">._coord)</span></div><div class="line">
</div><div class="line"><span style="color:#569CD6">    def</span><span style="color:#DCDCAA"> __str__</span><span style="color:#D4D4D4">(</span><span style="color:#9CDCFE">self</span><span style="color:#D4D4D4">):</span></div><div class="line"><span style="color:#C586C0">        return</span><span style="color:#569CD6"> f</span><span style="color:#CE9178">"&#x3C;Gobj (</span><span style="color:#569CD6">{self</span><span style="color:#D4D4D4">._coord.x</span><span style="color:#569CD6">}</span><span style="color:#CE9178">,</span><span style="color:#569CD6">{self</span><span style="color:#D4D4D4">._coord.y</span><span style="color:#569CD6">}</span><span style="color:#CE9178">) </span><span style="color:#569CD6">{self</span><span style="color:#D4D4D4">.sprite_name</span><span style="color:#569CD6">}</span><span style="color:#CE9178">>"</span></div><div class="line">
</div><div class="line"><span style="color:#6A9955">    # FUTURE : gérer une valeur de speed. transition = speed * distance à parcourir.</span></div><div class="line"><span style="color:#6A9955">    # FUTURE: message d'erreur plus explicite quand on déplace un objet en dehors du jeu.</span></div><div class="line"><span style="color:#6A9955">    # ou pas, car ça nécessite des vérifs qui vont faire ralentir...</span></div><div class="line">
</div><div class="line"><span style="color:#569CD6">    def</span><span style="color:#DCDCAA"> move_to_xy</span><span style="color:#D4D4D4">(</span><span style="color:#9CDCFE">self</span><span style="color:#D4D4D4">, </span><span style="color:#9CDCFE">x</span><span style="color:#D4D4D4">, </span><span style="color:#9CDCFE">y</span><span style="color:#D4D4D4">, </span><span style="color:#9CDCFE">transition_delay</span><span style="color:#D4D4D4">=</span><span style="color:#569CD6">None</span><span style="color:#D4D4D4">, </span><span style="color:#9CDCFE">callback</span><span style="color:#D4D4D4">=</span><span style="color:#569CD6">None</span><span style="color:#D4D4D4">):</span></div><div class="line"><span style="color:#C586C0">        if</span><span style="color:#569CD6"> self</span><span style="color:#D4D4D4">.layer_owner </span><span style="color:#569CD6">is</span><span style="color:#569CD6"> not</span><span style="color:#569CD6"> None</span><span style="color:#D4D4D4">:</span></div><div class="line"><span style="color:#569CD6">            self</span><span style="color:#D4D4D4">.layer_owner.move_game_object_xy(</span><span style="color:#569CD6">self</span><span style="color:#D4D4D4">, </span><span style="color:#569CD6">self</span><span style="color:#D4D4D4">._coord.x, </span><span style="color:#569CD6">self</span><span style="color:#D4D4D4">._coord.y, x, y)</span></div><div class="line"><span style="color:#569CD6">        self</span><span style="color:#D4D4D4">._coord.x = x</span></div><div class="line"><span style="color:#569CD6">        self</span><span style="color:#D4D4D4">._coord.y = y</span></div><div class="line"><span style="color:#569CD6">        self</span><span style="color:#D4D4D4">._one_shot_transition_delay = transition_delay</span></div><div class="line"><span style="color:#569CD6">        self</span><span style="color:#D4D4D4">._one_shot_callback = callback</span></div><div class="line">
</div><div class="line"><span style="color:#569CD6">    def</span><span style="color:#DCDCAA"> move_to</span><span style="color:#D4D4D4">(</span><span style="color:#9CDCFE">self</span><span style="color:#D4D4D4">, </span><span style="color:#9CDCFE">dest_coord</span><span style="color:#D4D4D4">, </span><span style="color:#9CDCFE">transition_delay</span><span style="color:#D4D4D4">=</span><span style="color:#569CD6">None</span><span style="color:#D4D4D4">, </span><span style="color:#9CDCFE">callback</span><span style="color:#D4D4D4">=</span><span style="color:#569CD6">None</span><span style="color:#D4D4D4">):</span></div><div class="line"><span style="color:#6A9955">        # Code dupliqué avec le code de move_to_xy.</span></div><div class="line"><span style="color:#6A9955">        # Je ne factorise pas, car ces deux fonctions vont être beaucoup utilisées.</span></div><div class="line"><span style="color:#6A9955">        # (y compris par le javascript). Ça permet d'optimiser un peu</span></div><div class="line"><span style="color:#6A9955">        # les performances, en évitant d'avoir une fonction qui appelle l'autre.</span></div><div class="line"><span style="color:#C586C0">        if</span><span style="color:#569CD6"> self</span><span style="color:#D4D4D4">.layer_owner </span><span style="color:#569CD6">is</span><span style="color:#569CD6"> not</span><span style="color:#569CD6"> None</span><span style="color:#D4D4D4">:</span></div><div class="line"><span style="color:#569CD6">            self</span><span style="color:#D4D4D4">.layer_owner.move_game_object(</span><span style="color:#569CD6">self</span><span style="color:#D4D4D4">, </span><span style="color:#569CD6">self</span><span style="color:#D4D4D4">._coord, dest_coord)</span></div><div class="line"><span style="color:#569CD6">        self</span><span style="color:#D4D4D4">._coord.x = dest_coord.x</span></div><div class="line"><span style="color:#569CD6">        self</span><span style="color:#D4D4D4">._coord.y = dest_coord.y</span></div><div class="line"><span style="color:#569CD6">        self</span><span style="color:#D4D4D4">._one_shot_transition_delay = transition_delay</span></div><div class="line"><span style="color:#569CD6">        self</span><span style="color:#D4D4D4">._one_shot_callback = callback</span></div><div class="line">
</div><div class="line"><span style="color:#569CD6">    def</span><span style="color:#DCDCAA"> move</span><span style="color:#D4D4D4">(</span><span style="color:#9CDCFE">self</span><span style="color:#D4D4D4">, </span><span style="color:#9CDCFE">vector</span><span style="color:#D4D4D4">, </span><span style="color:#9CDCFE">transition_delay</span><span style="color:#D4D4D4">=</span><span style="color:#569CD6">None</span><span style="color:#D4D4D4">, </span><span style="color:#9CDCFE">callback</span><span style="color:#D4D4D4">=</span><span style="color:#569CD6">None</span><span style="color:#D4D4D4">):</span></div><div class="line"><span style="color:#D4D4D4">        dest_x = </span><span style="color:#569CD6">self</span><span style="color:#D4D4D4">._coord.x + vector.x</span></div><div class="line"><span style="color:#D4D4D4">        dest_y = </span><span style="color:#569CD6">self</span><span style="color:#D4D4D4">._coord.y + vector.y</span></div><div class="line"><span style="color:#569CD6">        self</span><span style="color:#D4D4D4">.move_to_xy(dest_x, dest_y, transition_delay, callback)</span></div><div class="line">
</div><div class="line"><span style="color:#569CD6">    def</span><span style="color:#DCDCAA"> move_dir</span><span style="color:#D4D4D4">(</span><span style="color:#9CDCFE">self</span><span style="color:#D4D4D4">, </span><span style="color:#9CDCFE">direction</span><span style="color:#D4D4D4">, </span><span style="color:#9CDCFE">distance</span><span style="color:#D4D4D4">=</span><span style="color:#B5CEA8">1</span><span style="color:#D4D4D4">, </span><span style="color:#9CDCFE">transition_delay</span><span style="color:#D4D4D4">=</span><span style="color:#569CD6">None</span><span style="color:#D4D4D4">, </span><span style="color:#9CDCFE">callback</span><span style="color:#D4D4D4">=</span><span style="color:#569CD6">None</span><span style="color:#D4D4D4">):</span></div><div class="line"><span style="color:#D4D4D4">        unary_vect_x, unary_vect_y = direction.vector</span></div><div class="line"><span style="color:#D4D4D4">        dest_x = </span><span style="color:#569CD6">self</span><span style="color:#D4D4D4">._coord.x + unary_vect_x * distance</span></div><div class="line"><span style="color:#D4D4D4">        dest_y = </span><span style="color:#569CD6">self</span><span style="color:#D4D4D4">._coord.y + unary_vect_y * distance</span></div><div class="line"><span style="color:#569CD6">        self</span><span style="color:#D4D4D4">.move_to_xy(dest_x, dest_y, transition_delay, callback)</span></div><div class="line">
</div><div class="line"><span style="color:#569CD6">    def</span><span style="color:#DCDCAA"> add_transition</span><span style="color:#D4D4D4">(</span><span style="color:#9CDCFE">self</span><span style="color:#D4D4D4">, </span><span style="color:#9CDCFE">transition</span><span style="color:#D4D4D4">):</span></div><div class="line"><span style="color:#CE9178">        """</span></div><div class="line"><span style="color:#CE9178">        Le paramètre transition peut être une instance de Callback,</span></div><div class="line"><span style="color:#CE9178">        ou une instance de TransitionSteps.</span></div><div class="line"><span style="color:#CE9178">        """</span></div><div class="line"><span style="color:#6A9955">        # Au fur et à mesure qu'on applique ces transitions, il faut modifier les valeurs dans le jeu.</span></div><div class="line"><span style="color:#6A9955">        # Ça veut dire que c'est le javascript qui appelle la fonction move_to_xy du game_object,</span></div><div class="line"><span style="color:#6A9955">        # qui change le sprite_name, et éventuellement d'autres trucs.</span></div><div class="line"><span style="color:#6A9955">        # (On applique les valeurs d'une transition lorsqu'on la démarre)</span></div><div class="line"><span style="color:#569CD6">        self</span><span style="color:#D4D4D4">._transitions_to_record.append(transition)</span></div><div class="line">
</div><div class="line"><span style="color:#569CD6">    def</span><span style="color:#DCDCAA"> clear_transitions_to_record</span><span style="color:#D4D4D4">(</span><span style="color:#9CDCFE">self</span><span style="color:#D4D4D4">):</span></div><div class="line"><span style="color:#569CD6">        self</span><span style="color:#D4D4D4">._transitions_to_record[:] = []</span></div><div class="line">
</div><div class="line"><span style="color:#569CD6">    def</span><span style="color:#DCDCAA"> clear_all_transitions</span><span style="color:#D4D4D4">(</span><span style="color:#9CDCFE">self</span><span style="color:#D4D4D4">):</span></div><div class="line"><span style="color:#569CD6">        self</span><span style="color:#D4D4D4">._must_clear_transitions = </span><span style="color:#569CD6">True</span></div><div class="line">
</div><div class="line"><span style="color:#569CD6">    def</span><span style="color:#DCDCAA"> ack_cleared_all_transitions</span><span style="color:#D4D4D4">(</span><span style="color:#9CDCFE">self</span><span style="color:#D4D4D4">):</span></div><div class="line"><span style="color:#6A9955">        # Cette fonction est appelée par le moteur Squarity.</span></div><div class="line"><span style="color:#569CD6">        self</span><span style="color:#D4D4D4">._must_clear_transitions = </span><span style="color:#569CD6">False</span></div><div class="line">
</div><div class="line"><span style="color:#569CD6">    def</span><span style="color:#DCDCAA"> get_nb_undone_transitions</span><span style="color:#D4D4D4">(</span><span style="color:#9CDCFE">self</span><span style="color:#D4D4D4">):</span></div><div class="line"><span style="color:#C586C0">        if</span><span style="color:#569CD6"> self</span><span style="color:#D4D4D4">._transitioner </span><span style="color:#569CD6">is</span><span style="color:#569CD6"> None</span><span style="color:#D4D4D4">:</span></div><div class="line"><span style="color:#C586C0">            return</span><span style="color:#B5CEA8"> 0</span></div><div class="line"><span style="color:#C586C0">        else</span><span style="color:#D4D4D4">:</span></div><div class="line"><span style="color:#C586C0">            return</span><span style="color:#569CD6"> self</span><span style="color:#D4D4D4">._transitioner.getNbUndoneTransitions()</span></div><div class="line">
</div><div class="line"><span style="color:#569CD6">    def</span><span style="color:#DCDCAA"> set_callback_end_transi</span><span style="color:#D4D4D4">(</span><span style="color:#9CDCFE">self</span><span style="color:#D4D4D4">, </span><span style="color:#9CDCFE">callback_end_transi</span><span style="color:#D4D4D4">):</span></div><div class="line"><span style="color:#569CD6">        self</span><span style="color:#D4D4D4">._callback_end_transi = callback_end_transi</span></div><div class="line">
</div><div class="line"><span style="color:#569CD6">    def</span><span style="color:#DCDCAA"> set_transition_delay</span><span style="color:#D4D4D4">(</span><span style="color:#9CDCFE">self</span><span style="color:#D4D4D4">, </span><span style="color:#9CDCFE">transition_delay</span><span style="color:#D4D4D4">):</span></div><div class="line"><span style="color:#569CD6">        self</span><span style="color:#D4D4D4">._transition_delay = transition_delay</span></div><div class="line">
</div><div class="line"><span style="color:#569CD6">    def</span><span style="color:#DCDCAA"> reset_one_shot_transition_delay</span><span style="color:#D4D4D4">(</span><span style="color:#9CDCFE">self</span><span style="color:#D4D4D4">):</span></div><div class="line"><span style="color:#6A9955">        # Cette fonction est appelée par le moteur Squarity.</span></div><div class="line"><span style="color:#569CD6">        self</span><span style="color:#D4D4D4">._one_shot_transition_delay = </span><span style="color:#569CD6">None</span></div><div class="line">
</div><div class="line"><span style="color:#569CD6">    def</span><span style="color:#DCDCAA"> reset_one_shot_callback</span><span style="color:#D4D4D4">(</span><span style="color:#9CDCFE">self</span><span style="color:#D4D4D4">):</span></div><div class="line"><span style="color:#6A9955">        # Cette fonction est appelée par le moteur Squarity.</span></div><div class="line"><span style="color:#569CD6">        self</span><span style="color:#D4D4D4">._one_shot_callback = </span><span style="color:#569CD6">None</span></div><div class="line">
</div><div class="line">
</div><div class="line"><span style="color:#569CD6">class</span><span style="color:#4EC9B0"> ComponentImageModifier</span><span style="color:#D4D4D4">():</span></div><div class="line">
</div><div class="line"><span style="color:#D4D4D4">    default_tile_size = </span><span style="color:#B5CEA8">32</span></div><div class="line">
</div><div class="line"><span style="color:#569CD6">    def</span><span style="color:#DCDCAA"> set_default_tile_size</span><span style="color:#D4D4D4">(</span><span style="color:#9CDCFE">tile_size</span><span style="color:#D4D4D4">):</span></div><div class="line"><span style="color:#D4D4D4">        ComponentImageModifier.default_tile_size = tile_size</span></div><div class="line">
</div><div class="line"><span style="color:#569CD6">    def</span><span style="color:#DCDCAA"> __init__</span><span style="color:#D4D4D4">(</span></div><div class="line"><span style="color:#9CDCFE">        self</span><span style="color:#D4D4D4">,</span></div><div class="line"><span style="color:#9CDCFE">        img_offset_x</span><span style="color:#D4D4D4">=</span><span style="color:#B5CEA8">0</span><span style="color:#D4D4D4">, </span><span style="color:#9CDCFE">img_offset_y</span><span style="color:#D4D4D4">=</span><span style="color:#B5CEA8">0</span><span style="color:#D4D4D4">,</span></div><div class="line"><span style="color:#9CDCFE">        img_size_x</span><span style="color:#D4D4D4">=</span><span style="color:#569CD6">None</span><span style="color:#D4D4D4">, </span><span style="color:#9CDCFE">img_size_y</span><span style="color:#D4D4D4">=</span><span style="color:#569CD6">None</span><span style="color:#D4D4D4">,</span></div><div class="line"><span style="color:#9CDCFE">        area_offset_x</span><span style="color:#D4D4D4">=</span><span style="color:#B5CEA8">0.0</span><span style="color:#D4D4D4">, </span><span style="color:#9CDCFE">area_offset_y</span><span style="color:#D4D4D4">=</span><span style="color:#B5CEA8">0.0</span><span style="color:#D4D4D4">,</span></div><div class="line"><span style="color:#9CDCFE">        area_scale_x</span><span style="color:#D4D4D4">=</span><span style="color:#B5CEA8">1.0</span><span style="color:#D4D4D4">, </span><span style="color:#9CDCFE">area_scale_y</span><span style="color:#D4D4D4">=</span><span style="color:#B5CEA8">1.0</span><span style="color:#D4D4D4">,</span></div><div class="line"><span style="color:#D4D4D4">    ):</span></div><div class="line"><span style="color:#569CD6">        self</span><span style="color:#D4D4D4">.img_offset_x = img_offset_x</span></div><div class="line"><span style="color:#569CD6">        self</span><span style="color:#D4D4D4">.img_offset_y = img_offset_y</span></div><div class="line"><span style="color:#C586C0">        if</span><span style="color:#D4D4D4"> img_size_x </span><span style="color:#569CD6">is</span><span style="color:#569CD6"> None</span><span style="color:#D4D4D4">:</span></div><div class="line"><span style="color:#569CD6">            self</span><span style="color:#D4D4D4">.img_size_x = ComponentImageModifier.default_tile_size</span></div><div class="line"><span style="color:#C586C0">        else</span><span style="color:#D4D4D4">:</span></div><div class="line"><span style="color:#569CD6">            self</span><span style="color:#D4D4D4">.img_size_x = img_size_x</span></div><div class="line"><span style="color:#C586C0">        if</span><span style="color:#D4D4D4"> img_size_y </span><span style="color:#569CD6">is</span><span style="color:#569CD6"> None</span><span style="color:#D4D4D4">:</span></div><div class="line"><span style="color:#569CD6">            self</span><span style="color:#D4D4D4">.img_size_y = ComponentImageModifier.default_tile_size</span></div><div class="line"><span style="color:#C586C0">        else</span><span style="color:#D4D4D4">:</span></div><div class="line"><span style="color:#569CD6">            self</span><span style="color:#D4D4D4">.img_size_y = img_size_y</span></div><div class="line"><span style="color:#569CD6">        self</span><span style="color:#D4D4D4">.area_offset_x = area_offset_x</span></div><div class="line"><span style="color:#569CD6">        self</span><span style="color:#D4D4D4">.area_offset_y = area_offset_y</span></div><div class="line"><span style="color:#569CD6">        self</span><span style="color:#D4D4D4">.area_scale_x = area_scale_x</span></div><div class="line"><span style="color:#569CD6">        self</span><span style="color:#D4D4D4">.area_scale_y = area_scale_y</span></div><div class="line"><span style="color:#569CD6">        self</span><span style="color:#D4D4D4">._transitions_to_record = []</span></div><div class="line">
</div><div class="line"><span style="color:#569CD6">    def</span><span style="color:#DCDCAA"> add_transition</span><span style="color:#D4D4D4">(</span><span style="color:#9CDCFE">self</span><span style="color:#D4D4D4">, </span><span style="color:#9CDCFE">transition</span><span style="color:#D4D4D4">):</span></div><div class="line"><span style="color:#CE9178">        """</span></div><div class="line"><span style="color:#CE9178">        Le paramètre transition doit être une instance de TransitionSteps.</span></div><div class="line"><span style="color:#CE9178">        """</span></div><div class="line"><span style="color:#569CD6">        self</span><span style="color:#D4D4D4">._transitions_to_record.append(transition)</span></div><div class="line">
</div><div class="line"><span style="color:#569CD6">    def</span><span style="color:#DCDCAA"> clear_transitions_to_record</span><span style="color:#D4D4D4">(</span><span style="color:#9CDCFE">self</span><span style="color:#D4D4D4">):</span></div><div class="line"><span style="color:#569CD6">        self</span><span style="color:#D4D4D4">._transitions_to_record[:] = []</span></div><div class="line">
</div><div class="line">
</div><div class="line"><span style="color:#569CD6">class</span><span style="color:#4EC9B0"> ComponentBackCaller</span><span style="color:#D4D4D4">():</span></div><div class="line">
</div><div class="line"><span style="color:#569CD6">    def</span><span style="color:#DCDCAA"> __init__</span><span style="color:#D4D4D4">(</span><span style="color:#9CDCFE">self</span><span style="color:#D4D4D4">):</span></div><div class="line"><span style="color:#6A9955">        # Liste d'objets DelayedCallback</span></div><div class="line"><span style="color:#569CD6">        self</span><span style="color:#D4D4D4">._callbacks_to_record = []</span></div><div class="line">
</div><div class="line"><span style="color:#569CD6">    def</span><span style="color:#DCDCAA"> add_callback</span><span style="color:#D4D4D4">(</span><span style="color:#9CDCFE">self</span><span style="color:#D4D4D4">, </span><span style="color:#9CDCFE">delayed_callback</span><span style="color:#D4D4D4">):</span></div><div class="line"><span style="color:#569CD6">        self</span><span style="color:#D4D4D4">._callbacks_to_record.append(delayed_callback)</span></div><div class="line">
</div><div class="line"><span style="color:#569CD6">    def</span><span style="color:#DCDCAA"> clear_callbacks_to_record</span><span style="color:#D4D4D4">(</span><span style="color:#9CDCFE">self</span><span style="color:#D4D4D4">):</span></div><div class="line"><span style="color:#569CD6">        self</span><span style="color:#D4D4D4">._callbacks_to_record[:] = []</span></div><div class="line">
</div><div class="line">
</div><div class="line"><span style="color:#569CD6">class</span><span style="color:#4EC9B0"> Tile</span><span style="color:#D4D4D4">():</span></div><div class="line">
</div><div class="line"><span style="color:#569CD6">    def</span><span style="color:#DCDCAA"> __init__</span><span style="color:#D4D4D4">(</span><span style="color:#9CDCFE">self</span><span style="color:#D4D4D4">, </span><span style="color:#9CDCFE">layer_owner</span><span style="color:#D4D4D4">, </span><span style="color:#9CDCFE">coord</span><span style="color:#D4D4D4">):</span></div><div class="line"><span style="color:#569CD6">        self</span><span style="color:#D4D4D4">.layer_owner = layer_owner</span></div><div class="line"><span style="color:#569CD6">        self</span><span style="color:#D4D4D4">._coord = coord</span></div><div class="line"><span style="color:#569CD6">        self</span><span style="color:#D4D4D4">.game_objects = []</span></div><div class="line"><span style="color:#6A9955">        # Cette variable contiendra un tuple de 8 éléments, qui sera les tiles adjacentes,</span></div><div class="line"><span style="color:#6A9955">        # diagonales comprises, ordonnées de la même manière que Direction.</span></div><div class="line"><span style="color:#6A9955">        # (en partant du haut et dans le sens des aiguilles d'une montre).</span></div><div class="line"><span style="color:#569CD6">        self</span><span style="color:#D4D4D4">.adjacencies = </span><span style="color:#569CD6">None</span></div><div class="line">
</div><div class="line"><span style="color:#569CD6">    def</span><span style="color:#DCDCAA"> get_coord</span><span style="color:#D4D4D4">(</span><span style="color:#9CDCFE">self</span><span style="color:#D4D4D4">):</span></div><div class="line"><span style="color:#C586C0">        return</span><span style="color:#D4D4D4"> Coord(</span><span style="color:#9CDCFE">coord</span><span style="color:#D4D4D4">=</span><span style="color:#569CD6">self</span><span style="color:#D4D4D4">._coord)</span></div><div class="line">
</div><div class="line">
</div><div class="line"><span style="color:#569CD6">class</span><span style="color:#4EC9B0"> LayerBase</span><span style="color:#D4D4D4">():</span></div><div class="line">
</div><div class="line"><span style="color:#569CD6">    def</span><span style="color:#DCDCAA"> __init__</span><span style="color:#D4D4D4">(</span><span style="color:#9CDCFE">self</span><span style="color:#D4D4D4">, </span><span style="color:#9CDCFE">game_owner</span><span style="color:#D4D4D4">):</span></div><div class="line"><span style="color:#569CD6">        self</span><span style="color:#D4D4D4">.game_owner = game_owner</span></div><div class="line"><span style="color:#569CD6">        self</span><span style="color:#D4D4D4">._l_id = </span><span style="color:#DCDCAA">id</span><span style="color:#D4D4D4">(</span><span style="color:#569CD6">self</span><span style="color:#D4D4D4">)</span></div><div class="line"><span style="color:#569CD6">        self</span><span style="color:#D4D4D4">.visible = </span><span style="color:#569CD6">True</span></div><div class="line">
</div><div class="line"><span style="color:#569CD6">    def</span><span style="color:#DCDCAA"> get_game_objects</span><span style="color:#D4D4D4">(</span><span style="color:#9CDCFE">self</span><span style="color:#D4D4D4">, </span><span style="color:#9CDCFE">coord</span><span style="color:#D4D4D4">):</span></div><div class="line"><span style="color:#C586C0">        raise</span><span style="color:#4EC9B0"> NotImplementedError</span></div><div class="line">
</div><div class="line"><span style="color:#569CD6">    def</span><span style="color:#DCDCAA"> iter_all_game_objects</span><span style="color:#D4D4D4">(</span><span style="color:#9CDCFE">self</span><span style="color:#D4D4D4">):</span></div><div class="line"><span style="color:#CE9178">        """</span></div><div class="line"><span style="color:#CE9178">        The order is not guaranteed.</span></div><div class="line"><span style="color:#CE9178">        """</span></div><div class="line"><span style="color:#C586C0">        raise</span><span style="color:#4EC9B0"> NotImplementedError</span></div><div class="line">
</div><div class="line"><span style="color:#569CD6">    def</span><span style="color:#DCDCAA"> add_game_object</span><span style="color:#D4D4D4">(</span><span style="color:#9CDCFE">self</span><span style="color:#D4D4D4">, </span><span style="color:#9CDCFE">gobj</span><span style="color:#D4D4D4">):</span></div><div class="line"><span style="color:#C586C0">        raise</span><span style="color:#4EC9B0"> NotImplementedError</span></div><div class="line">
</div><div class="line"><span style="color:#569CD6">    def</span><span style="color:#DCDCAA"> remove_game_object</span><span style="color:#D4D4D4">(</span><span style="color:#9CDCFE">self</span><span style="color:#D4D4D4">, </span><span style="color:#9CDCFE">gobj</span><span style="color:#D4D4D4">):</span></div><div class="line"><span style="color:#C586C0">        raise</span><span style="color:#4EC9B0"> NotImplementedError</span></div><div class="line">
</div><div class="line"><span style="color:#569CD6">    def</span><span style="color:#DCDCAA"> remove_at_coord</span><span style="color:#D4D4D4">(</span><span style="color:#9CDCFE">self</span><span style="color:#D4D4D4">, </span><span style="color:#9CDCFE">coord</span><span style="color:#D4D4D4">):</span></div><div class="line"><span style="color:#C586C0">        raise</span><span style="color:#4EC9B0"> NotImplementedError</span></div><div class="line">
</div><div class="line"><span style="color:#569CD6">    def</span><span style="color:#DCDCAA"> move_game_object</span><span style="color:#D4D4D4">(</span><span style="color:#9CDCFE">self</span><span style="color:#D4D4D4">, </span><span style="color:#9CDCFE">gobj</span><span style="color:#D4D4D4">, </span><span style="color:#9CDCFE">src_coord</span><span style="color:#D4D4D4">, </span><span style="color:#9CDCFE">dest_coord</span><span style="color:#D4D4D4">):</span></div><div class="line"><span style="color:#CE9178">        """</span></div><div class="line"><span style="color:#CE9178">        You should not directly call this function.</span></div><div class="line"><span style="color:#CE9178">        Just call gobj.move_to, gobj.move_to_xy, gobj.move or gobj.move_dir.</span></div><div class="line"><span style="color:#CE9178">        """</span></div><div class="line"><span style="color:#C586C0">        raise</span><span style="color:#4EC9B0"> NotImplementedError</span></div><div class="line">
</div><div class="line"><span style="color:#569CD6">    def</span><span style="color:#DCDCAA"> move_game_object_xy</span><span style="color:#D4D4D4">(</span><span style="color:#9CDCFE">self</span><span style="color:#D4D4D4">, </span><span style="color:#9CDCFE">gobj</span><span style="color:#D4D4D4">, </span><span style="color:#9CDCFE">src_x</span><span style="color:#D4D4D4">, </span><span style="color:#9CDCFE">src_y</span><span style="color:#D4D4D4">, </span><span style="color:#9CDCFE">dest_x</span><span style="color:#D4D4D4">, </span><span style="color:#9CDCFE">dest_y</span><span style="color:#D4D4D4">):</span></div><div class="line"><span style="color:#CE9178">        """</span></div><div class="line"><span style="color:#CE9178">        You should not directly call this function.</span></div><div class="line"><span style="color:#CE9178">        Just call gobj.move_to, gobj.move_to_xy, gobj.move or gobj.move_dir.</span></div><div class="line"><span style="color:#CE9178">        """</span></div><div class="line"><span style="color:#C586C0">        raise</span><span style="color:#4EC9B0"> NotImplementedError</span></div><div class="line">
</div><div class="line">
</div><div class="line"><span style="color:#569CD6">class</span><span style="color:#4EC9B0"> Layer</span><span style="color:#D4D4D4">(</span><span style="color:#4EC9B0">LayerBase</span><span style="color:#D4D4D4">):</span></div><div class="line">
</div><div class="line"><span style="color:#569CD6">    def</span><span style="color:#DCDCAA"> __init__</span><span style="color:#D4D4D4">(</span><span style="color:#9CDCFE">self</span><span style="color:#D4D4D4">, </span><span style="color:#9CDCFE">game_owner</span><span style="color:#D4D4D4">, </span><span style="color:#9CDCFE">w</span><span style="color:#D4D4D4">, </span><span style="color:#9CDCFE">h</span><span style="color:#D4D4D4">, </span><span style="color:#9CDCFE">show_transitions</span><span style="color:#D4D4D4">=</span><span style="color:#569CD6">True</span><span style="color:#D4D4D4">):</span></div><div class="line"><span style="color:#4EC9B0">        super</span><span style="color:#D4D4D4">().</span><span style="color:#DCDCAA">__init__</span><span style="color:#D4D4D4">(game_owner)</span></div><div class="line"><span style="color:#569CD6">        self</span><span style="color:#D4D4D4">.w = w</span></div><div class="line"><span style="color:#569CD6">        self</span><span style="color:#D4D4D4">.h = h</span></div><div class="line"><span style="color:#569CD6">        self</span><span style="color:#D4D4D4">.show_transitions = show_transitions</span></div><div class="line"><span style="color:#569CD6">        self</span><span style="color:#D4D4D4">.tiles = [</span></div><div class="line"><span style="color:#D4D4D4">            [</span></div><div class="line"><span style="color:#D4D4D4">                Tile(</span><span style="color:#569CD6">self</span><span style="color:#D4D4D4">, Coord(x, y)) </span><span style="color:#C586C0">for</span><span style="color:#D4D4D4"> x </span><span style="color:#C586C0">in</span><span style="color:#DCDCAA"> range</span><span style="color:#D4D4D4">(w)</span></div><div class="line"><span style="color:#D4D4D4">            ]</span></div><div class="line"><span style="color:#C586C0">            for</span><span style="color:#D4D4D4"> y </span><span style="color:#C586C0">in</span><span style="color:#DCDCAA"> range</span><span style="color:#D4D4D4">(h)</span></div><div class="line"><span style="color:#D4D4D4">        ]</span></div><div class="line"><span style="color:#C586C0">        for</span><span style="color:#D4D4D4"> y </span><span style="color:#C586C0">in</span><span style="color:#DCDCAA"> range</span><span style="color:#D4D4D4">(h):</span></div><div class="line"><span style="color:#C586C0">            for</span><span style="color:#D4D4D4"> x </span><span style="color:#C586C0">in</span><span style="color:#DCDCAA"> range</span><span style="color:#D4D4D4">(w):</span></div><div class="line"><span style="color:#569CD6">                self</span><span style="color:#D4D4D4">.tiles[y][x].adjacencies = </span><span style="color:#569CD6">self</span><span style="color:#D4D4D4">._make_adjacencies(x, y)</span></div><div class="line">
</div><div class="line"><span style="color:#569CD6">    def</span><span style="color:#DCDCAA"> _make_adjacencies</span><span style="color:#D4D4D4">(</span><span style="color:#9CDCFE">self</span><span style="color:#D4D4D4">, </span><span style="color:#9CDCFE">x</span><span style="color:#D4D4D4">, </span><span style="color:#9CDCFE">y</span><span style="color:#D4D4D4">):</span></div><div class="line"><span style="color:#CE9178">        """</span></div><div class="line"><span style="color:#CE9178">        Returns a tuple of 8 elements containing the adjacent tiles.</span></div><div class="line"><span style="color:#CE9178">        Some of the elements can be None, if the x and y are at a border.</span></div><div class="line"><span style="color:#CE9178">        """</span></div><div class="line"><span style="color:#D4D4D4">        adjacencies = (</span></div><div class="line"><span style="color:#569CD6">            self</span><span style="color:#D4D4D4">.tiles[y - </span><span style="color:#B5CEA8">1</span><span style="color:#D4D4D4">][x] </span><span style="color:#C586C0">if</span><span style="color:#B5CEA8"> 0</span><span style="color:#D4D4D4"> &#x3C;= y - </span><span style="color:#B5CEA8">1</span><span style="color:#C586C0"> else</span><span style="color:#569CD6"> None</span><span style="color:#D4D4D4">,</span></div><div class="line"><span style="color:#569CD6">            self</span><span style="color:#D4D4D4">.tiles[y - </span><span style="color:#B5CEA8">1</span><span style="color:#D4D4D4">][x + </span><span style="color:#B5CEA8">1</span><span style="color:#D4D4D4">] </span><span style="color:#C586C0">if</span><span style="color:#B5CEA8"> 0</span><span style="color:#D4D4D4"> &#x3C;= y - </span><span style="color:#B5CEA8">1</span><span style="color:#569CD6"> and</span><span style="color:#D4D4D4"> x + </span><span style="color:#B5CEA8">1</span><span style="color:#D4D4D4"> &#x3C; </span><span style="color:#569CD6">self</span><span style="color:#D4D4D4">.w </span><span style="color:#C586C0">else</span><span style="color:#569CD6"> None</span><span style="color:#D4D4D4">,</span></div><div class="line"><span style="color:#569CD6">            self</span><span style="color:#D4D4D4">.tiles[y][x + </span><span style="color:#B5CEA8">1</span><span style="color:#D4D4D4">] </span><span style="color:#C586C0">if</span><span style="color:#D4D4D4"> x + </span><span style="color:#B5CEA8">1</span><span style="color:#D4D4D4"> &#x3C; </span><span style="color:#569CD6">self</span><span style="color:#D4D4D4">.w </span><span style="color:#C586C0">else</span><span style="color:#569CD6"> None</span><span style="color:#D4D4D4">,</span></div><div class="line"><span style="color:#569CD6">            self</span><span style="color:#D4D4D4">.tiles[y + </span><span style="color:#B5CEA8">1</span><span style="color:#D4D4D4">][x + </span><span style="color:#B5CEA8">1</span><span style="color:#D4D4D4">] </span><span style="color:#C586C0">if</span><span style="color:#D4D4D4"> y + </span><span style="color:#B5CEA8">1</span><span style="color:#D4D4D4"> &#x3C; </span><span style="color:#569CD6">self</span><span style="color:#D4D4D4">.h </span><span style="color:#569CD6">and</span><span style="color:#D4D4D4"> x + </span><span style="color:#B5CEA8">1</span><span style="color:#D4D4D4"> &#x3C; </span><span style="color:#569CD6">self</span><span style="color:#D4D4D4">.w </span><span style="color:#C586C0">else</span><span style="color:#569CD6"> None</span><span style="color:#D4D4D4">,</span></div><div class="line"><span style="color:#569CD6">            self</span><span style="color:#D4D4D4">.tiles[y + </span><span style="color:#B5CEA8">1</span><span style="color:#D4D4D4">][x] </span><span style="color:#C586C0">if</span><span style="color:#D4D4D4"> y + </span><span style="color:#B5CEA8">1</span><span style="color:#D4D4D4"> &#x3C; </span><span style="color:#569CD6">self</span><span style="color:#D4D4D4">.h </span><span style="color:#C586C0">else</span><span style="color:#569CD6"> None</span><span style="color:#D4D4D4">,</span></div><div class="line"><span style="color:#569CD6">            self</span><span style="color:#D4D4D4">.tiles[y + </span><span style="color:#B5CEA8">1</span><span style="color:#D4D4D4">][x - </span><span style="color:#B5CEA8">1</span><span style="color:#D4D4D4">] </span><span style="color:#C586C0">if</span><span style="color:#D4D4D4"> y + </span><span style="color:#B5CEA8">1</span><span style="color:#D4D4D4"> &#x3C; </span><span style="color:#569CD6">self</span><span style="color:#D4D4D4">.h </span><span style="color:#569CD6">and</span><span style="color:#B5CEA8"> 0</span><span style="color:#D4D4D4"> &#x3C;= x - </span><span style="color:#B5CEA8">1</span><span style="color:#C586C0"> else</span><span style="color:#569CD6"> None</span><span style="color:#D4D4D4">,</span></div><div class="line"><span style="color:#569CD6">            self</span><span style="color:#D4D4D4">.tiles[y][x - </span><span style="color:#B5CEA8">1</span><span style="color:#D4D4D4">] </span><span style="color:#C586C0">if</span><span style="color:#B5CEA8"> 0</span><span style="color:#D4D4D4"> &#x3C;= x - </span><span style="color:#B5CEA8">1</span><span style="color:#C586C0"> else</span><span style="color:#569CD6"> None</span><span style="color:#D4D4D4">,</span></div><div class="line"><span style="color:#569CD6">            self</span><span style="color:#D4D4D4">.tiles[y - </span><span style="color:#B5CEA8">1</span><span style="color:#D4D4D4">][x - </span><span style="color:#B5CEA8">1</span><span style="color:#D4D4D4">] </span><span style="color:#C586C0">if</span><span style="color:#B5CEA8"> 0</span><span style="color:#D4D4D4"> &#x3C;= y - </span><span style="color:#B5CEA8">1</span><span style="color:#569CD6"> and</span><span style="color:#B5CEA8"> 0</span><span style="color:#D4D4D4"> &#x3C;= x - </span><span style="color:#B5CEA8">1</span><span style="color:#C586C0"> else</span><span style="color:#569CD6"> None</span><span style="color:#D4D4D4">,</span></div><div class="line"><span style="color:#D4D4D4">        )</span></div><div class="line"><span style="color:#C586C0">        return</span><span style="color:#D4D4D4"> adjacencies</span></div><div class="line">
</div><div class="line"><span style="color:#569CD6">    def</span><span style="color:#DCDCAA"> get_game_objects</span><span style="color:#D4D4D4">(</span><span style="color:#9CDCFE">self</span><span style="color:#D4D4D4">, </span><span style="color:#9CDCFE">coord</span><span style="color:#D4D4D4">):</span></div><div class="line"><span style="color:#C586C0">        return</span><span style="color:#569CD6"> self</span><span style="color:#D4D4D4">.get_tile(coord).game_objects</span></div><div class="line">
</div><div class="line"><span style="color:#569CD6">    def</span><span style="color:#DCDCAA"> iter_all_game_objects</span><span style="color:#D4D4D4">(</span><span style="color:#9CDCFE">self</span><span style="color:#D4D4D4">):</span></div><div class="line"><span style="color:#C586C0">        for</span><span style="color:#D4D4D4"> line </span><span style="color:#C586C0">in</span><span style="color:#569CD6"> self</span><span style="color:#D4D4D4">.tiles:</span></div><div class="line"><span style="color:#C586C0">            for</span><span style="color:#D4D4D4"> tile </span><span style="color:#C586C0">in</span><span style="color:#D4D4D4"> line:</span></div><div class="line"><span style="color:#C586C0">                for</span><span style="color:#D4D4D4"> gobj </span><span style="color:#C586C0">in</span><span style="color:#D4D4D4"> tile.game_objects:</span></div><div class="line"><span style="color:#C586C0">                    yield</span><span style="color:#D4D4D4"> gobj</span></div><div class="line">
</div><div class="line"><span style="color:#569CD6">    def</span><span style="color:#DCDCAA"> get_tile</span><span style="color:#D4D4D4">(</span><span style="color:#9CDCFE">self</span><span style="color:#D4D4D4">, </span><span style="color:#9CDCFE">coord</span><span style="color:#D4D4D4">):</span></div><div class="line"><span style="color:#C586C0">        return</span><span style="color:#569CD6"> self</span><span style="color:#D4D4D4">.tiles[coord.y][coord.x]</span></div><div class="line">
</div><div class="line"><span style="color:#569CD6">    def</span><span style="color:#DCDCAA"> get_tile_xy</span><span style="color:#D4D4D4">(</span><span style="color:#9CDCFE">self</span><span style="color:#D4D4D4">, </span><span style="color:#9CDCFE">x</span><span style="color:#D4D4D4">, </span><span style="color:#9CDCFE">y</span><span style="color:#D4D4D4">):</span></div><div class="line"><span style="color:#C586C0">        return</span><span style="color:#569CD6"> self</span><span style="color:#D4D4D4">.tiles[y][x]</span></div><div class="line">
</div><div class="line"><span style="color:#569CD6">    def</span><span style="color:#DCDCAA"> add_game_object</span><span style="color:#D4D4D4">(</span><span style="color:#9CDCFE">self</span><span style="color:#D4D4D4">, </span><span style="color:#9CDCFE">gobj</span><span style="color:#D4D4D4">):</span></div><div class="line"><span style="color:#D4D4D4">        gobj.layer_owner = </span><span style="color:#569CD6">self</span></div><div class="line"><span style="color:#D4D4D4">        tile = </span><span style="color:#569CD6">self</span><span style="color:#D4D4D4">.get_tile(gobj._coord)</span></div><div class="line"><span style="color:#D4D4D4">        tile.game_objects.append(gobj)</span></div><div class="line">
</div><div class="line"><span style="color:#569CD6">    def</span><span style="color:#DCDCAA"> remove_game_object</span><span style="color:#D4D4D4">(</span><span style="color:#9CDCFE">self</span><span style="color:#D4D4D4">, </span><span style="color:#9CDCFE">gobj</span><span style="color:#D4D4D4">):</span></div><div class="line"><span style="color:#D4D4D4">        gobj.layer_owner = </span><span style="color:#569CD6">None</span></div><div class="line"><span style="color:#D4D4D4">        tile = </span><span style="color:#569CD6">self</span><span style="color:#D4D4D4">.get_tile(gobj._coord)</span></div><div class="line"><span style="color:#D4D4D4">        tile.game_objects.remove(gobj)</span></div><div class="line">
</div><div class="line"><span style="color:#569CD6">    def</span><span style="color:#DCDCAA"> remove_at_coord</span><span style="color:#D4D4D4">(</span><span style="color:#9CDCFE">self</span><span style="color:#D4D4D4">, </span><span style="color:#9CDCFE">coord</span><span style="color:#D4D4D4">):</span></div><div class="line"><span style="color:#D4D4D4">        tile = </span><span style="color:#569CD6">self</span><span style="color:#D4D4D4">.get_tile(coord)</span></div><div class="line"><span style="color:#C586C0">        for</span><span style="color:#D4D4D4"> gobj </span><span style="color:#C586C0">in</span><span style="color:#D4D4D4"> tile.game_objects:</span></div><div class="line"><span style="color:#D4D4D4">            gobj.layer_owner = </span><span style="color:#569CD6">None</span></div><div class="line"><span style="color:#D4D4D4">        tile.game_objects = []</span></div><div class="line">
</div><div class="line"><span style="color:#569CD6">    def</span><span style="color:#DCDCAA"> move_game_object</span><span style="color:#D4D4D4">(</span><span style="color:#9CDCFE">self</span><span style="color:#D4D4D4">, </span><span style="color:#9CDCFE">gobj</span><span style="color:#D4D4D4">, </span><span style="color:#9CDCFE">src_coord</span><span style="color:#D4D4D4">, </span><span style="color:#9CDCFE">dest_coord</span><span style="color:#D4D4D4">):</span></div><div class="line"><span style="color:#6A9955">        # Cette fonction est appelée par les Game Objects.</span></div><div class="line"><span style="color:#6A9955">        # Il ne faut pas l'appeler directement.</span></div><div class="line"><span style="color:#569CD6">        self</span><span style="color:#D4D4D4">.get_tile(src_coord).game_objects.remove(gobj)</span></div><div class="line"><span style="color:#569CD6">        self</span><span style="color:#D4D4D4">.get_tile(dest_coord).game_objects.append(gobj)</span></div><div class="line">
</div><div class="line"><span style="color:#569CD6">    def</span><span style="color:#DCDCAA"> move_game_object_xy</span><span style="color:#D4D4D4">(</span><span style="color:#9CDCFE">self</span><span style="color:#D4D4D4">, </span><span style="color:#9CDCFE">gobj</span><span style="color:#D4D4D4">, </span><span style="color:#9CDCFE">src_x</span><span style="color:#D4D4D4">, </span><span style="color:#9CDCFE">src_y</span><span style="color:#D4D4D4">, </span><span style="color:#9CDCFE">dest_x</span><span style="color:#D4D4D4">, </span><span style="color:#9CDCFE">dest_y</span><span style="color:#D4D4D4">):</span></div><div class="line"><span style="color:#6A9955">        # Cette fonction est appelée par les Game Objects.</span></div><div class="line"><span style="color:#6A9955">        # Il ne faut pas l'appeler directement.</span></div><div class="line"><span style="color:#569CD6">        self</span><span style="color:#D4D4D4">.get_tile_xy(src_x, src_y).game_objects.remove(gobj)</span></div><div class="line"><span style="color:#569CD6">        self</span><span style="color:#D4D4D4">.get_tile_xy(dest_x, dest_y).game_objects.append(gobj)</span></div><div class="line">
</div><div class="line">
</div><div class="line"><span style="color:#569CD6">class</span><span style="color:#4EC9B0"> LayerSparse</span><span style="color:#D4D4D4">(</span><span style="color:#4EC9B0">LayerBase</span><span style="color:#D4D4D4">):</span></div><div class="line">
</div><div class="line"><span style="color:#569CD6">    def</span><span style="color:#DCDCAA"> __init__</span><span style="color:#D4D4D4">(</span><span style="color:#9CDCFE">self</span><span style="color:#D4D4D4">, </span><span style="color:#9CDCFE">game_owner</span><span style="color:#D4D4D4">, </span><span style="color:#9CDCFE">w</span><span style="color:#D4D4D4">, </span><span style="color:#9CDCFE">h</span><span style="color:#D4D4D4">, </span><span style="color:#9CDCFE">show_transitions</span><span style="color:#D4D4D4">=</span><span style="color:#569CD6">True</span><span style="color:#D4D4D4">):</span></div><div class="line"><span style="color:#4EC9B0">        super</span><span style="color:#D4D4D4">().</span><span style="color:#DCDCAA">__init__</span><span style="color:#D4D4D4">(game_owner)</span></div><div class="line"><span style="color:#569CD6">        self</span><span style="color:#D4D4D4">.w = w</span></div><div class="line"><span style="color:#569CD6">        self</span><span style="color:#D4D4D4">.h = h</span></div><div class="line"><span style="color:#569CD6">        self</span><span style="color:#D4D4D4">.show_transitions = show_transitions</span></div><div class="line"><span style="color:#569CD6">        self</span><span style="color:#D4D4D4">.game_objects = []</span></div><div class="line">
</div><div class="line"><span style="color:#569CD6">    def</span><span style="color:#DCDCAA"> get_game_objects</span><span style="color:#D4D4D4">(</span><span style="color:#9CDCFE">self</span><span style="color:#D4D4D4">, </span><span style="color:#9CDCFE">coord</span><span style="color:#D4D4D4">):</span></div><div class="line"><span style="color:#C586C0">        return</span><span style="color:#D4D4D4"> [</span></div><div class="line"><span style="color:#D4D4D4">            gobj </span><span style="color:#C586C0">for</span><span style="color:#D4D4D4"> gobj</span></div><div class="line"><span style="color:#C586C0">            in</span><span style="color:#569CD6"> self</span><span style="color:#D4D4D4">.game_objects</span></div><div class="line"><span style="color:#C586C0">            if</span><span style="color:#D4D4D4"> gobj._coord == coord</span></div><div class="line"><span style="color:#D4D4D4">        ]</span></div><div class="line">
</div><div class="line"><span style="color:#569CD6">    def</span><span style="color:#DCDCAA"> iter_all_game_objects</span><span style="color:#D4D4D4">(</span><span style="color:#9CDCFE">self</span><span style="color:#D4D4D4">):</span></div><div class="line"><span style="color:#C586C0">        for</span><span style="color:#D4D4D4"> gobj </span><span style="color:#C586C0">in</span><span style="color:#569CD6"> self</span><span style="color:#D4D4D4">.game_objects:</span></div><div class="line"><span style="color:#C586C0">            yield</span><span style="color:#D4D4D4"> gobj</span></div><div class="line">
</div><div class="line"><span style="color:#569CD6">    def</span><span style="color:#DCDCAA"> add_game_object</span><span style="color:#D4D4D4">(</span><span style="color:#9CDCFE">self</span><span style="color:#D4D4D4">, </span><span style="color:#9CDCFE">gobj</span><span style="color:#D4D4D4">):</span></div><div class="line"><span style="color:#D4D4D4">        gobj.layer_owner = </span><span style="color:#569CD6">self</span></div><div class="line"><span style="color:#569CD6">        self</span><span style="color:#D4D4D4">.game_objects.append(gobj)</span></div><div class="line">
</div><div class="line"><span style="color:#569CD6">    def</span><span style="color:#DCDCAA"> remove_game_object</span><span style="color:#D4D4D4">(</span><span style="color:#9CDCFE">self</span><span style="color:#D4D4D4">, </span><span style="color:#9CDCFE">gobj</span><span style="color:#D4D4D4">):</span></div><div class="line"><span style="color:#D4D4D4">        gobj.layer_owner = </span><span style="color:#569CD6">None</span></div><div class="line"><span style="color:#569CD6">        self</span><span style="color:#D4D4D4">.game_objects.remove(gobj)</span></div><div class="line">
</div><div class="line"><span style="color:#569CD6">    def</span><span style="color:#DCDCAA"> remove_at_coord</span><span style="color:#D4D4D4">(</span><span style="color:#9CDCFE">self</span><span style="color:#D4D4D4">, </span><span style="color:#9CDCFE">coord</span><span style="color:#D4D4D4">):</span></div><div class="line"><span style="color:#D4D4D4">        gobj_to_remove = [</span></div><div class="line"><span style="color:#D4D4D4">            gobj </span><span style="color:#C586C0">for</span><span style="color:#D4D4D4"> gobj</span></div><div class="line"><span style="color:#C586C0">            in</span><span style="color:#569CD6"> self</span><span style="color:#D4D4D4">.game_objects</span></div><div class="line"><span style="color:#C586C0">            if</span><span style="color:#D4D4D4"> gobj._coord == coord</span></div><div class="line"><span style="color:#D4D4D4">        ]</span></div><div class="line"><span style="color:#C586C0">        for</span><span style="color:#D4D4D4"> gobj </span><span style="color:#C586C0">in</span><span style="color:#D4D4D4"> gobj_to_remove:</span></div><div class="line"><span style="color:#D4D4D4">            gobj.layer_owner = </span><span style="color:#569CD6">None</span></div><div class="line"><span style="color:#569CD6">            self</span><span style="color:#D4D4D4">.game_objects.remove(gobj)</span></div><div class="line">
</div><div class="line"><span style="color:#569CD6">    def</span><span style="color:#DCDCAA"> move_game_object</span><span style="color:#D4D4D4">(</span><span style="color:#9CDCFE">self</span><span style="color:#D4D4D4">, </span><span style="color:#9CDCFE">gobj</span><span style="color:#D4D4D4">, </span><span style="color:#9CDCFE">src_coord</span><span style="color:#D4D4D4">, </span><span style="color:#9CDCFE">dest_coord</span><span style="color:#D4D4D4">):</span></div><div class="line"><span style="color:#6A9955">        # Les coordonnées ont déjà été modifiées dans le gameObject.</span></div><div class="line"><span style="color:#6A9955">        # On n'a rien à faire pour le LayerSparse lui-même,</span></div><div class="line"><span style="color:#6A9955">        # car il se contente de stocker une liste de gameObject.</span></div><div class="line"><span style="color:#C586C0">        pass</span></div><div class="line">
</div><div class="line"><span style="color:#569CD6">    def</span><span style="color:#DCDCAA"> move_game_object_xy</span><span style="color:#D4D4D4">(</span><span style="color:#9CDCFE">self</span><span style="color:#D4D4D4">, </span><span style="color:#9CDCFE">gobj</span><span style="color:#D4D4D4">, </span><span style="color:#9CDCFE">src_x</span><span style="color:#D4D4D4">, </span><span style="color:#9CDCFE">src_y</span><span style="color:#D4D4D4">, </span><span style="color:#9CDCFE">dest_x</span><span style="color:#D4D4D4">, </span><span style="color:#9CDCFE">dest_y</span><span style="color:#D4D4D4">):</span></div><div class="line"><span style="color:#6A9955">        # Pareil que move_game_object</span></div><div class="line"><span style="color:#C586C0">        pass</span></div><div class="line">
</div><div class="line"><span style="color:#569CD6">class</span><span style="color:#4EC9B0"> EventResult</span><span style="color:#D4D4D4">():</span></div><div class="line">
</div><div class="line"><span style="color:#569CD6">    def</span><span style="color:#DCDCAA"> __init__</span><span style="color:#D4D4D4">(</span><span style="color:#9CDCFE">self</span><span style="color:#D4D4D4">):</span></div><div class="line"><span style="color:#569CD6">        self</span><span style="color:#D4D4D4">.delayed_callbacks = []</span></div><div class="line"><span style="color:#569CD6">        self</span><span style="color:#D4D4D4">.plocks_custom = []</span></div><div class="line"><span style="color:#569CD6">        self</span><span style="color:#D4D4D4">.punlocks_custom = []</span></div><div class="line">
</div><div class="line"><span style="color:#569CD6">    def</span><span style="color:#DCDCAA"> add_delayed_callback</span><span style="color:#D4D4D4">(</span><span style="color:#9CDCFE">self</span><span style="color:#D4D4D4">, </span><span style="color:#9CDCFE">delayed_callback</span><span style="color:#D4D4D4">):</span></div><div class="line"><span style="color:#C586C0">        if</span><span style="color:#569CD6"> not</span><span style="color:#DCDCAA"> isinstance</span><span style="color:#D4D4D4">(delayed_callback, DelayedCallBack):</span></div><div class="line"><span style="color:#C586C0">            raise</span><span style="color:#4EC9B0"> Exception</span><span style="color:#D4D4D4">(</span></div><div class="line"><span style="color:#CE9178">                "delayed_callback must be an instance of DelayedCallBack"</span></div><div class="line"><span style="color:#D4D4D4">            )</span></div><div class="line"><span style="color:#569CD6">        self</span><span style="color:#D4D4D4">.delayed_callbacks.append(delayed_callback)</span></div><div class="line">
</div><div class="line">
</div><div class="line"><span style="color:#569CD6">class</span><span style="color:#4EC9B0"> DelayedCallBack</span><span style="color:#D4D4D4">():</span></div><div class="line">
</div><div class="line"><span style="color:#569CD6">    def</span><span style="color:#DCDCAA"> __init__</span><span style="color:#D4D4D4">(</span><span style="color:#9CDCFE">self</span><span style="color:#D4D4D4">, </span><span style="color:#9CDCFE">delay</span><span style="color:#D4D4D4">, </span><span style="color:#9CDCFE">callback</span><span style="color:#D4D4D4">):</span></div><div class="line"><span style="color:#569CD6">        self</span><span style="color:#D4D4D4">.delay = delay</span></div><div class="line"><span style="color:#569CD6">        self</span><span style="color:#D4D4D4">.callback = callback</span></div><div class="line">
</div><div class="line">
</div><div class="line"><span style="color:#569CD6">class</span><span style="color:#4EC9B0"> SequenceableIterator</span><span style="color:#D4D4D4">():</span></div><div class="line">
</div><div class="line"><span style="color:#569CD6">    def</span><span style="color:#DCDCAA"> set_iter_prec</span><span style="color:#D4D4D4">(</span><span style="color:#9CDCFE">self</span><span style="color:#D4D4D4">, </span><span style="color:#9CDCFE">iter_prec</span><span style="color:#D4D4D4">):</span></div><div class="line"><span style="color:#569CD6">        self</span><span style="color:#D4D4D4">.iter_prec = iter_prec</span></div><div class="line">
</div><div class="line"><span style="color:#569CD6">    def</span><span style="color:#DCDCAA"> __iter__</span><span style="color:#D4D4D4">(</span><span style="color:#9CDCFE">self</span><span style="color:#D4D4D4">):</span></div><div class="line"><span style="color:#C586C0">        return</span><span style="color:#569CD6"> self</span></div><div class="line">
</div><div class="line"><span style="color:#569CD6">    def</span><span style="color:#DCDCAA"> __next__</span><span style="color:#D4D4D4">(</span><span style="color:#9CDCFE">self</span><span style="color:#D4D4D4">):</span></div><div class="line"><span style="color:#C586C0">        raise</span><span style="color:#569CD6"> NotImplemented</span></div><div class="line">
</div><div class="line">
</div><div class="line"><span style="color:#569CD6">class</span><span style="color:#4EC9B0"> RectIterator</span><span style="color:#D4D4D4">(</span><span style="color:#4EC9B0">SequenceableIterator</span><span style="color:#D4D4D4">):</span></div><div class="line"><span style="color:#6A9955">    # FUTURE. Itérateur de coordonnées où on avance de 2 en 2, (ou plus),</span></div><div class="line"><span style="color:#6A9955">    #         Itérateur de droite à gauche, par colonnes et non pas par lignes. etc.</span></div><div class="line">
</div><div class="line"><span style="color:#569CD6">    def</span><span style="color:#DCDCAA"> __init__</span><span style="color:#D4D4D4">(</span><span style="color:#9CDCFE">self</span><span style="color:#D4D4D4">, </span><span style="color:#9CDCFE">rect</span><span style="color:#D4D4D4">, </span><span style="color:#9CDCFE">instanciate_coord</span><span style="color:#D4D4D4">=</span><span style="color:#569CD6">False</span><span style="color:#D4D4D4">):</span></div><div class="line"><span style="color:#569CD6">        self</span><span style="color:#D4D4D4">.rect = rect</span></div><div class="line"><span style="color:#569CD6">        self</span><span style="color:#D4D4D4">.instanciate_coord = instanciate_coord</span></div><div class="line"><span style="color:#569CD6">        self</span><span style="color:#D4D4D4">.current_coord = </span><span style="color:#569CD6">None</span></div><div class="line">
</div><div class="line"><span style="color:#569CD6">    def</span><span style="color:#DCDCAA"> __next__</span><span style="color:#D4D4D4">(</span><span style="color:#9CDCFE">self</span><span style="color:#D4D4D4">):</span></div><div class="line"><span style="color:#C586C0">        if</span><span style="color:#569CD6"> self</span><span style="color:#D4D4D4">.current_coord </span><span style="color:#569CD6">is</span><span style="color:#569CD6"> None</span><span style="color:#D4D4D4">:</span></div><div class="line"><span style="color:#569CD6">            self</span><span style="color:#D4D4D4">.current_coord = Coord(</span><span style="color:#569CD6">self</span><span style="color:#D4D4D4">.rect.x, </span><span style="color:#569CD6">self</span><span style="color:#D4D4D4">.rect.y)</span></div><div class="line"><span style="color:#C586C0">        else</span><span style="color:#D4D4D4">:</span></div><div class="line"><span style="color:#569CD6">            self</span><span style="color:#D4D4D4">.current_coord.x += </span><span style="color:#B5CEA8">1</span></div><div class="line"><span style="color:#C586C0">            if</span><span style="color:#569CD6"> self</span><span style="color:#D4D4D4">.current_coord.x >= </span><span style="color:#569CD6">self</span><span style="color:#D4D4D4">.rect.x + </span><span style="color:#569CD6">self</span><span style="color:#D4D4D4">.rect.w:</span></div><div class="line"><span style="color:#569CD6">                self</span><span style="color:#D4D4D4">.current_coord.x = </span><span style="color:#569CD6">self</span><span style="color:#D4D4D4">.rect.x</span></div><div class="line"><span style="color:#569CD6">                self</span><span style="color:#D4D4D4">.current_coord.y += </span><span style="color:#B5CEA8">1</span></div><div class="line"><span style="color:#C586C0">                if</span><span style="color:#569CD6"> self</span><span style="color:#D4D4D4">.current_coord.y >= </span><span style="color:#569CD6">self</span><span style="color:#D4D4D4">.rect.y + </span><span style="color:#569CD6">self</span><span style="color:#D4D4D4">.rect.h:</span></div><div class="line"><span style="color:#C586C0">                    raise</span><span style="color:#4EC9B0"> StopIteration</span></div><div class="line"><span style="color:#C586C0">        if</span><span style="color:#569CD6"> self</span><span style="color:#D4D4D4">.instanciate_coord:</span></div><div class="line"><span style="color:#C586C0">            return</span><span style="color:#D4D4D4"> Coord(</span><span style="color:#9CDCFE">coord</span><span style="color:#D4D4D4">=</span><span style="color:#569CD6">self</span><span style="color:#D4D4D4">.current_coord)</span></div><div class="line"><span style="color:#C586C0">        else</span><span style="color:#D4D4D4">:</span></div><div class="line"><span style="color:#C586C0">            return</span><span style="color:#569CD6"> self</span><span style="color:#D4D4D4">.current_coord</span></div><div class="line">
</div><div class="line">
</div><div class="line"><span style="color:#569CD6">class</span><span style="color:#4EC9B0"> GameObjectIterator</span><span style="color:#D4D4D4">(</span><span style="color:#4EC9B0">SequenceableIterator</span><span style="color:#D4D4D4">):</span></div><div class="line">
</div><div class="line"><span style="color:#569CD6">    def</span><span style="color:#DCDCAA"> __init__</span><span style="color:#D4D4D4">(</span><span style="color:#9CDCFE">self</span><span style="color:#D4D4D4">, </span><span style="color:#9CDCFE">layers</span><span style="color:#D4D4D4">):</span></div><div class="line"><span style="color:#569CD6">        self</span><span style="color:#D4D4D4">.layers = layers</span></div><div class="line"><span style="color:#569CD6">        self</span><span style="color:#D4D4D4">.current_game_objects = []</span></div><div class="line">
</div><div class="line"><span style="color:#569CD6">    def</span><span style="color:#DCDCAA"> __next__</span><span style="color:#D4D4D4">(</span><span style="color:#9CDCFE">self</span><span style="color:#D4D4D4">):</span></div><div class="line"><span style="color:#C586C0">        while</span><span style="color:#569CD6"> not</span><span style="color:#569CD6"> self</span><span style="color:#D4D4D4">.current_game_objects:</span></div><div class="line"><span style="color:#D4D4D4">            coord = </span><span style="color:#DCDCAA">next</span><span style="color:#D4D4D4">(</span><span style="color:#569CD6">self</span><span style="color:#D4D4D4">.iter_prec)</span></div><div class="line"><span style="color:#C586C0">            for</span><span style="color:#D4D4D4"> layer </span><span style="color:#C586C0">in</span><span style="color:#569CD6"> self</span><span style="color:#D4D4D4">.layers:</span></div><div class="line"><span style="color:#569CD6">                self</span><span style="color:#D4D4D4">.current_game_objects.extend(</span></div><div class="line"><span style="color:#D4D4D4">                    layer.get_game_objects(coord)</span></div><div class="line"><span style="color:#D4D4D4">                )</span></div><div class="line"><span style="color:#D4D4D4">        gobj = </span><span style="color:#569CD6">self</span><span style="color:#D4D4D4">.current_game_objects.pop(</span><span style="color:#B5CEA8">0</span><span style="color:#D4D4D4">)</span></div><div class="line"><span style="color:#C586C0">        return</span><span style="color:#D4D4D4"> gobj</span></div><div class="line">
</div><div class="line">
</div><div class="line"><span style="color:#569CD6">class</span><span style="color:#4EC9B0"> GameObjectIteratorGroupByCoords</span><span style="color:#D4D4D4">(</span><span style="color:#4EC9B0">SequenceableIterator</span><span style="color:#D4D4D4">):</span></div><div class="line">
</div><div class="line"><span style="color:#569CD6">    def</span><span style="color:#DCDCAA"> __init__</span><span style="color:#D4D4D4">(</span><span style="color:#9CDCFE">self</span><span style="color:#D4D4D4">, </span><span style="color:#9CDCFE">layers</span><span style="color:#D4D4D4">):</span></div><div class="line"><span style="color:#569CD6">        self</span><span style="color:#D4D4D4">.layers = layers</span></div><div class="line">
</div><div class="line"><span style="color:#569CD6">    def</span><span style="color:#DCDCAA"> __next__</span><span style="color:#D4D4D4">(</span><span style="color:#9CDCFE">self</span><span style="color:#D4D4D4">):</span></div><div class="line"><span style="color:#D4D4D4">        current_game_objects = []</span></div><div class="line"><span style="color:#D4D4D4">        coord = </span><span style="color:#DCDCAA">next</span><span style="color:#D4D4D4">(</span><span style="color:#569CD6">self</span><span style="color:#D4D4D4">.iter_prec)</span></div><div class="line"><span style="color:#C586C0">        for</span><span style="color:#D4D4D4"> layer </span><span style="color:#C586C0">in</span><span style="color:#569CD6"> self</span><span style="color:#D4D4D4">.layers:</span></div><div class="line"><span style="color:#D4D4D4">            current_game_objects.extend(</span></div><div class="line"><span style="color:#D4D4D4">                layer.get_game_objects(coord)</span></div><div class="line"><span style="color:#D4D4D4">            )</span></div><div class="line"><span style="color:#C586C0">        return</span><span style="color:#D4D4D4"> current_game_objects</span></div><div class="line">
</div><div class="line">
</div><div class="line"><span style="color:#569CD6">class</span><span style="color:#4EC9B0"> FilterBySpriteName</span><span style="color:#D4D4D4">(</span><span style="color:#4EC9B0">SequenceableIterator</span><span style="color:#D4D4D4">):</span></div><div class="line">
</div><div class="line"><span style="color:#569CD6">    def</span><span style="color:#DCDCAA"> __init__</span><span style="color:#D4D4D4">(</span><span style="color:#9CDCFE">self</span><span style="color:#D4D4D4">, </span><span style="color:#9CDCFE">sprite_names</span><span style="color:#D4D4D4">, </span><span style="color:#9CDCFE">skip_empty_lists</span><span style="color:#D4D4D4">=</span><span style="color:#569CD6">False</span><span style="color:#D4D4D4">):</span></div><div class="line"><span style="color:#569CD6">        self</span><span style="color:#D4D4D4">.sprite_names = sprite_names</span></div><div class="line"><span style="color:#569CD6">        self</span><span style="color:#D4D4D4">.skip_empty_lists = skip_empty_lists</span></div><div class="line">
</div><div class="line"><span style="color:#569CD6">    def</span><span style="color:#DCDCAA"> set_iter_prec</span><span style="color:#D4D4D4">(</span><span style="color:#9CDCFE">self</span><span style="color:#D4D4D4">, </span><span style="color:#9CDCFE">iter_prec</span><span style="color:#D4D4D4">):</span></div><div class="line"><span style="color:#569CD6">        self</span><span style="color:#D4D4D4">.iter_prec = iter_prec</span></div><div class="line"><span style="color:#6A9955">        # Un peu bof ce "isinstance". Ça passe...</span></div><div class="line"><span style="color:#569CD6">        self</span><span style="color:#D4D4D4">.receive_gobj_lists = </span><span style="color:#DCDCAA">isinstance</span><span style="color:#D4D4D4">(</span></div><div class="line"><span style="color:#569CD6">            self</span><span style="color:#D4D4D4">.iter_prec, GameObjectIteratorGroupByCoords</span></div><div class="line"><span style="color:#D4D4D4">        )</span></div><div class="line">
</div><div class="line"><span style="color:#569CD6">    def</span><span style="color:#DCDCAA"> __next__</span><span style="color:#D4D4D4">(</span><span style="color:#9CDCFE">self</span><span style="color:#D4D4D4">):</span></div><div class="line"><span style="color:#C586C0">        if</span><span style="color:#569CD6"> self</span><span style="color:#D4D4D4">.receive_gobj_lists:</span></div><div class="line"><span style="color:#C586C0">            while</span><span style="color:#569CD6"> True</span><span style="color:#D4D4D4">:</span></div><div class="line"><span style="color:#D4D4D4">                game_objects = </span><span style="color:#DCDCAA">next</span><span style="color:#D4D4D4">(</span><span style="color:#569CD6">self</span><span style="color:#D4D4D4">.iter_prec)</span></div><div class="line"><span style="color:#D4D4D4">                game_objects = [</span></div><div class="line"><span style="color:#D4D4D4">                    gobj </span><span style="color:#C586C0">for</span><span style="color:#D4D4D4"> gobj</span></div><div class="line"><span style="color:#C586C0">                    in</span><span style="color:#D4D4D4"> game_objects</span></div><div class="line"><span style="color:#C586C0">                    if</span><span style="color:#D4D4D4"> gobj.sprite_name </span><span style="color:#569CD6">in</span><span style="color:#569CD6"> self</span><span style="color:#D4D4D4">.sprite_names</span></div><div class="line"><span style="color:#D4D4D4">                ]</span></div><div class="line"><span style="color:#C586C0">                if</span><span style="color:#D4D4D4"> game_objects </span><span style="color:#569CD6">or</span><span style="color:#569CD6"> not</span><span style="color:#569CD6"> self</span><span style="color:#D4D4D4">.skip_empty_lists:</span></div><div class="line"><span style="color:#C586C0">                    return</span><span style="color:#D4D4D4"> game_objects</span></div><div class="line"><span style="color:#C586C0">        else</span><span style="color:#D4D4D4">:</span></div><div class="line"><span style="color:#C586C0">            while</span><span style="color:#569CD6"> True</span><span style="color:#D4D4D4">:</span></div><div class="line"><span style="color:#D4D4D4">                gobj = </span><span style="color:#DCDCAA">next</span><span style="color:#D4D4D4">(</span><span style="color:#569CD6">self</span><span style="color:#D4D4D4">.iter_prec)</span></div><div class="line"><span style="color:#C586C0">                if</span><span style="color:#D4D4D4"> gobj.sprite_name </span><span style="color:#569CD6">in</span><span style="color:#569CD6"> self</span><span style="color:#D4D4D4">.sprite_names:</span></div><div class="line"><span style="color:#C586C0">                    return</span><span style="color:#D4D4D4"> gobj</span></div><div class="line">
</div><div class="line">
</div><div class="line"><span style="color:#569CD6">class</span><span style="color:#4EC9B0"> Sequencer</span><span style="color:#D4D4D4">():</span></div><div class="line">
</div><div class="line"><span style="color:#569CD6">    def</span><span style="color:#DCDCAA"> iter_on_rect</span><span style="color:#D4D4D4">(</span><span style="color:#9CDCFE">rect</span><span style="color:#D4D4D4">, </span><span style="color:#9CDCFE">instanciate_coord</span><span style="color:#D4D4D4">=</span><span style="color:#569CD6">False</span><span style="color:#D4D4D4">):</span></div><div class="line"><span style="color:#C586C0">        return</span><span style="color:#D4D4D4"> RectIterator(rect, instanciate_coord)</span></div><div class="line">
</div><div class="line"><span style="color:#569CD6">    def</span><span style="color:#DCDCAA"> gobj_on_layers</span><span style="color:#D4D4D4">(</span><span style="color:#9CDCFE">layers</span><span style="color:#D4D4D4">):</span></div><div class="line"><span style="color:#C586C0">        return</span><span style="color:#D4D4D4"> GameObjectIterator(layers)</span></div><div class="line">
</div><div class="line"><span style="color:#569CD6">    def</span><span style="color:#DCDCAA"> gobj_on_layers_by_coords</span><span style="color:#D4D4D4">(</span><span style="color:#9CDCFE">layers</span><span style="color:#D4D4D4">):</span></div><div class="line"><span style="color:#C586C0">        return</span><span style="color:#D4D4D4"> GameObjectIteratorGroupByCoords(layers)</span></div><div class="line">
</div><div class="line"><span style="color:#569CD6">    def</span><span style="color:#DCDCAA"> filter_sprites</span><span style="color:#D4D4D4">(</span><span style="color:#9CDCFE">sprite_names</span><span style="color:#D4D4D4">, </span><span style="color:#9CDCFE">skip_empty_lists</span><span style="color:#D4D4D4">=</span><span style="color:#569CD6">False</span><span style="color:#D4D4D4">):</span></div><div class="line"><span style="color:#C586C0">        return</span><span style="color:#D4D4D4"> FilterBySpriteName(sprite_names, skip_empty_lists)</span></div><div class="line">
</div><div class="line"><span style="color:#569CD6">    def</span><span style="color:#DCDCAA"> seq_iter</span><span style="color:#D4D4D4">(*</span><span style="color:#9CDCFE">sequenceable_iterators</span><span style="color:#D4D4D4">):</span></div><div class="line"><span style="color:#C586C0">        for</span><span style="color:#D4D4D4"> seq_iter_prec, seq_iter </span><span style="color:#C586C0">in</span><span style="color:#DCDCAA"> zip</span><span style="color:#D4D4D4">(sequenceable_iterators, sequenceable_iterators[</span><span style="color:#B5CEA8">1</span><span style="color:#D4D4D4">:]):</span></div><div class="line"><span style="color:#D4D4D4">            seq_iter.set_iter_prec(seq_iter_prec)</span></div><div class="line"><span style="color:#D4D4D4">        last_seq = sequenceable_iterators[-</span><span style="color:#B5CEA8">1</span><span style="color:#D4D4D4">]</span></div><div class="line"><span style="color:#C586C0">        for</span><span style="color:#D4D4D4"> elem </span><span style="color:#C586C0">in</span><span style="color:#D4D4D4"> last_seq:</span></div><div class="line"><span style="color:#C586C0">            yield</span><span style="color:#D4D4D4"> elem</span></div><div class="line">
</div><div class="line"><span style="color:#569CD6">    def</span><span style="color:#DCDCAA"> seq_first</span><span style="color:#D4D4D4">(*</span><span style="color:#9CDCFE">sequenceable_iterators</span><span style="color:#D4D4D4">):</span></div><div class="line"><span style="color:#C586C0">        for</span><span style="color:#D4D4D4"> seq_iter_prec, seq_iter </span><span style="color:#C586C0">in</span><span style="color:#DCDCAA"> zip</span><span style="color:#D4D4D4">(sequenceable_iterators, sequenceable_iterators[</span><span style="color:#B5CEA8">1</span><span style="color:#D4D4D4">:]):</span></div><div class="line"><span style="color:#D4D4D4">            seq_iter.set_iter_prec(seq_iter_prec)</span></div><div class="line"><span style="color:#D4D4D4">        last_seq = sequenceable_iterators[-</span><span style="color:#B5CEA8">1</span><span style="color:#D4D4D4">]</span></div><div class="line"><span style="color:#C586C0">        for</span><span style="color:#D4D4D4"> elem </span><span style="color:#C586C0">in</span><span style="color:#D4D4D4"> last_seq:</span></div><div class="line"><span style="color:#C586C0">            return</span><span style="color:#D4D4D4"> elem</span></div><div class="line"><span style="color:#C586C0">        return</span><span style="color:#569CD6"> None</span></div><div class="line">
</div><div class="line"><span style="color:#6A9955"># autres use cases:</span></div><div class="line"><span style="color:#6A9955"># group by coords ? ou alors c'est un paramètre du GameObjectIterator.</span></div><div class="line"><span style="color:#6A9955"># group by coords, mais on envoie aussi les coords ou c'est vide, avec une liste vide dedans.</span></div><div class="line"><span style="color:#6A9955"># différents ordre de parcours pour les coordonnées (par colonnes, de bas en haut, de droite à gauche, ...)</span></div><div class="line"><span style="color:#6A9955"># les cases deux par deux, genre les cases noires d'un échiquier.</span></div><div class="line">
</div><div class="line"><span style="color:#6A9955"># Par exemple, pour la gravité.</span></div><div class="line"><span style="color:#6A9955"># Pour chaque colonne (itération normale avec un range)</span></div><div class="line"><span style="color:#6A9955"># on fait deux itérateurs de coords décalés, avec un zip. Le premier (case de destination) itère sur les coords,</span></div><div class="line"><span style="color:#6A9955"># le second (case de source) itère sur les objets par groupe.</span></div><div class="line"><span style="color:#6A9955"># À chaque itération, on déplace les objets. On breake quand on rencontre un truc qui arrête la gravité, genre un mur non déplaçable.</span></div><div class="line"><span style="color:#6A9955"># Ou alors, on itère sur toute la colonne, et on garde un petit booléen pour dire si ça tombe ou pas.</span></div><div class="line"><span style="color:#6A9955"># Selon qu'on trouve une case vide, une case avec un objet tombable, ou une case avec un mur, on change le booléen.</span></div><div class="line">
</div><div class="line"><span style="color:#6A9955"># Est-ce qu'on peut faire un flood fill, basé sur certaines conditions de propagation ?</span></div><div class="line"><span style="color:#6A9955"># C'est plus compliqué. Le flood fill, on peut pas le faire avec des enchaînements d'itérateurs.</span></div><div class="line"><span style="color:#6A9955"># C'est un itérateur en entier avec tout dedans.</span></div><div class="line">
</div><div class="line">
</div><div class="line"><span style="color:#569CD6">class</span><span style="color:#4EC9B0"> GameModelBase</span><span style="color:#D4D4D4">():</span></div><div class="line">
</div><div class="line"><span style="color:#569CD6">    def</span><span style="color:#DCDCAA"> __init__</span><span style="color:#D4D4D4">(</span><span style="color:#9CDCFE">self</span><span style="color:#D4D4D4">, </span><span style="color:#9CDCFE">w</span><span style="color:#D4D4D4">, </span><span style="color:#9CDCFE">h</span><span style="color:#D4D4D4">, </span><span style="color:#9CDCFE">tile_size</span><span style="color:#D4D4D4">, </span><span style="color:#9CDCFE">str_game_conf_json</span><span style="color:#D4D4D4">):</span></div><div class="line"><span style="color:#569CD6">        self</span><span style="color:#D4D4D4">.w = w</span></div><div class="line"><span style="color:#569CD6">        self</span><span style="color:#D4D4D4">.h = h</span></div><div class="line"><span style="color:#569CD6">        self</span><span style="color:#D4D4D4">.str_game_conf_json = str_game_conf_json</span></div><div class="line"><span style="color:#569CD6">        self</span><span style="color:#D4D4D4">.rect = Rect(</span><span style="color:#B5CEA8">0</span><span style="color:#D4D4D4">, </span><span style="color:#B5CEA8">0</span><span style="color:#D4D4D4">, </span><span style="color:#569CD6">self</span><span style="color:#D4D4D4">.w, </span><span style="color:#569CD6">self</span><span style="color:#D4D4D4">.h)</span></div><div class="line"><span style="color:#569CD6">        self</span><span style="color:#D4D4D4">.layers = []</span></div><div class="line"><span style="color:#569CD6">        self</span><span style="color:#D4D4D4">.layer_main = Layer(</span><span style="color:#569CD6">self</span><span style="color:#D4D4D4">, w, h)</span></div><div class="line"><span style="color:#569CD6">        self</span><span style="color:#D4D4D4">.layers.append(</span><span style="color:#569CD6">self</span><span style="color:#D4D4D4">.layer_main)</span></div><div class="line"><span style="color:#D4D4D4">        ComponentImageModifier.set_default_tile_size(tile_size)</span></div><div class="line"><span style="color:#6A9955">        # Par défaut: 200 ms de transition lorsqu'on déplace un objet.</span></div><div class="line"><span style="color:#569CD6">        self</span><span style="color:#D4D4D4">.transition_delay = </span><span style="color:#B5CEA8">200</span></div><div class="line">
</div><div class="line"><span style="color:#569CD6">    def</span><span style="color:#DCDCAA"> get_first_gobj</span><span style="color:#D4D4D4">(</span><span style="color:#9CDCFE">self</span><span style="color:#D4D4D4">, </span><span style="color:#9CDCFE">coord</span><span style="color:#D4D4D4">=</span><span style="color:#569CD6">None</span><span style="color:#D4D4D4">, </span><span style="color:#9CDCFE">sprite_names</span><span style="color:#D4D4D4">=</span><span style="color:#569CD6">None</span><span style="color:#D4D4D4">, </span><span style="color:#9CDCFE">layer</span><span style="color:#D4D4D4">=</span><span style="color:#569CD6">None</span><span style="color:#D4D4D4">):</span></div><div class="line"><span style="color:#C586C0">        if</span><span style="color:#D4D4D4"> coord </span><span style="color:#569CD6">is</span><span style="color:#569CD6"> None</span><span style="color:#D4D4D4">:</span></div><div class="line"><span style="color:#D4D4D4">            coord_iterator = Sequencer.iter_on_rect(</span><span style="color:#569CD6">self</span><span style="color:#D4D4D4">.rect)</span></div><div class="line"><span style="color:#C586C0">        elif</span><span style="color:#DCDCAA"> isinstance</span><span style="color:#D4D4D4">(coord, Coord):</span></div><div class="line"><span style="color:#D4D4D4">            coord_iterator = </span><span style="color:#DCDCAA">iter</span><span style="color:#D4D4D4">([coord])</span></div><div class="line"><span style="color:#C586C0">        elif</span><span style="color:#DCDCAA"> isinstance</span><span style="color:#D4D4D4">(coord, Rect):</span></div><div class="line"><span style="color:#D4D4D4">            coord_iterator = Sequencer.iter_on_rect(coord)</span></div><div class="line"><span style="color:#C586C0">        else</span><span style="color:#D4D4D4">:</span></div><div class="line"><span style="color:#D4D4D4">            coord_iterator = coord</span></div><div class="line">
</div><div class="line"><span style="color:#C586C0">        if</span><span style="color:#D4D4D4"> layer </span><span style="color:#569CD6">is</span><span style="color:#569CD6"> None</span><span style="color:#D4D4D4">:</span></div><div class="line"><span style="color:#D4D4D4">            layers = </span><span style="color:#569CD6">self</span><span style="color:#D4D4D4">.layers</span></div><div class="line"><span style="color:#C586C0">        else</span><span style="color:#D4D4D4">:</span></div><div class="line"><span style="color:#D4D4D4">            layers = [layer]</span></div><div class="line">
</div><div class="line"><span style="color:#D4D4D4">        iterators = [coord_iterator, Sequencer.gobj_on_layers(layers)]</span></div><div class="line"><span style="color:#C586C0">        if</span><span style="color:#D4D4D4"> sprite_names </span><span style="color:#569CD6">is</span><span style="color:#569CD6"> not</span><span style="color:#569CD6"> None</span><span style="color:#D4D4D4">:</span></div><div class="line"><span style="color:#D4D4D4">            iterators.append(Sequencer.filter_sprites(sprite_names))</span></div><div class="line"><span style="color:#C586C0">        return</span><span style="color:#D4D4D4"> Sequencer.seq_first(*iterators)</span></div><div class="line">
</div><div class="line"><span style="color:#569CD6">    def</span><span style="color:#DCDCAA"> on_start</span><span style="color:#D4D4D4">(</span><span style="color:#9CDCFE">self</span><span style="color:#D4D4D4">):</span></div><div class="line"><span style="color:#C586C0">        pass</span></div><div class="line">
</div><div class="line"><span style="color:#569CD6">    def</span><span style="color:#DCDCAA"> on_click</span><span style="color:#D4D4D4">(</span><span style="color:#9CDCFE">self</span><span style="color:#D4D4D4">, </span><span style="color:#9CDCFE">coord</span><span style="color:#D4D4D4">):</span></div><div class="line"><span style="color:#C586C0">        pass</span></div><div class="line">
</div><div class="line"><span style="color:#569CD6">    def</span><span style="color:#DCDCAA"> on_button_direction</span><span style="color:#D4D4D4">(</span><span style="color:#9CDCFE">self</span><span style="color:#D4D4D4">, </span><span style="color:#9CDCFE">direction</span><span style="color:#D4D4D4">):</span></div><div class="line"><span style="color:#CE9178">        """</span></div><div class="line"><span style="color:#CE9178">        Utilisez direction.vector pour avoir le tuple (dx, dy) du bouton de direction.</span></div><div class="line"><span style="color:#CE9178">        """</span></div><div class="line"><span style="color:#C586C0">        pass</span></div><div class="line">
</div><div class="line"><span style="color:#569CD6">    def</span><span style="color:#DCDCAA"> on_button_action</span><span style="color:#D4D4D4">(</span><span style="color:#9CDCFE">self</span><span style="color:#D4D4D4">, </span><span style="color:#9CDCFE">action_name</span><span style="color:#D4D4D4">):</span></div><div class="line"><span style="color:#C586C0">        pass</span></div><div class="line">
</div><div class="line">
</div></code></pre>

    </div>
</template>


